var ROS3D=function(e,t,i,s){"use strict";function r(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}function o(e){if(e&&e.__esModule)return e;var t=Object.create(null);return e&&Object.keys(e).forEach((function(i){if("default"!==i){var s=Object.getOwnPropertyDescriptor(e,i);Object.defineProperty(t,i,s.get?s:{enumerable:!0,get:function(){return e[i]}})}})),t.default=e,Object.freeze(t)}var n=o(t),a=r(t),c=o(i),h=Object.assign({},n),l=function(e,t,i,s){var r=new h.Color;return r.setRGB(e,t,i),s<=.99?new h.MeshBasicMaterial({color:r.getHex(),opacity:s+.1,transparent:!0,depthWrite:!0,blendSrc:h.SrcAlphaFactor,blendDst:h.OneMinusSrcAlphaFactor,blendEquation:h.ReverseSubtractEquation,blending:h.NormalBlending}):new h.MeshPhongMaterial({color:r.getHex(),opacity:s,blending:h.NormalBlending})},u=function(e,t,i){var s=new h.Vector3,r=new h.Vector3;s.subVectors(t,e.origin);var o=e.direction.dot(i);if(!(Math.abs(o)<e.precision)){var n=i.dot(s)/o;return r.addVectors(e.origin,e.direction.clone().multiplyScalar(n)),r}},p=function(e,t){var i=new h.Vector3;i.subVectors(e.origin,t.origin);var s=t.direction.clone(),r=e.direction.clone(),o=i.dot(s),n=s.dot(r),a=i.dot(r),c=s.dot(s),l=r.dot(r)*c-n*n;if(!(Math.abs(l)<=1e-4))return(o*n-a*c)/l},d=function(e,t,i){var s=e.origin.clone();s.project(t);var r=e.direction.clone().add(e.origin);r.project(t);var o=r.clone().sub(s),n=(new h.Vector2).subVectors(i,s).dot(o)/o.dot(o),a=new h.Vector2;a.addVectors(s,o.clone().multiplyScalar(n));var c=new h.Vector3(a.x,a.y,.5);c.unproject(t);var l=new h.Ray(t.position,c.sub(t.position).normalize());return p(e,l)};class f extends h.Object3D{constructor(e){super(),e=e||{},this.url=e.url,this.streamType=e.streamType||"vp8",this.f=e.f||526,this.maxDepthPerTile=e.maxDepthPerTile||1,this.pointSize=e.pointSize||3,this.width=e.width||1024,this.height=e.height||1024,this.resolutionFactor=Math.max(this.width,this.height)/1024,this.whiteness=e.whiteness||0,this.varianceThreshold=e.varianceThreshold||16667e-9,this.isMjpeg="mjpeg"===this.streamType.toLowerCase(),this.video=document.createElement(this.isMjpeg?"img":"video"),this.video.crossOrigin="Anonymous",this.video.addEventListener(this.isMjpeg?"load":"loadedmetadata",this.metaLoaded.bind(this),!1),this.isMjpeg||(this.video.loop=!0),this.video.src=this.url,this.video.setAttribute("crossorigin","Anonymous"),this.vertex_shader=["uniform sampler2D map;","","uniform float width;","uniform float height;","uniform float nearClipping, farClipping;","","uniform float pointSize;","uniform float zOffset;","","uniform float focallength;","uniform float maxDepthPerTile;","uniform float resolutionFactor;","","varying vec2 vUvP;","varying vec2 colorP;","","varying float depthVariance;","varying float maskVal;","","float sampleDepth(vec2 pos)","  {","    float depth;","    ","    vec2 vUv = vec2( pos.x / (width*2.0), pos.y / (height*2.0)+0.5 );","    vec2 vUv2 = vec2( pos.x / (width*2.0)+0.5, pos.y / (height*2.0)+0.5 );","    ","    vec4 depthColor = texture2D( map, vUv );","    ","    depth = ( depthColor.r + depthColor.g + depthColor.b ) / 3.0 ;","    ","    if (depth>0.99)","    {","      vec4 depthColor2 = texture2D( map, vUv2 );","      float depth2 = ( depthColor2.r + depthColor2.g + depthColor2.b ) / 3.0 ;","      depth = 0.99+depth2;","    }","    ","    return depth;","  }","","float median(float a, float b, float c)","  {","    float r=a;","    ","    if ( (a<b) && (b<c) )","    {","      r = b;","    }","    if ( (a<c) && (c<b) )","    {","      r = c;","    }","    return r;","  }","","float variance(float d1, float d2, float d3, float d4, float d5, float d6, float d7, float d8, float d9)","  {","    float mean = (d1 + d2 + d3 + d4 + d5 + d6 + d7 + d8 + d9) / 9.0;","    float t1 = (d1-mean);","    float t2 = (d2-mean);","    float t3 = (d3-mean);","    float t4 = (d4-mean);","    float t5 = (d5-mean);","    float t6 = (d6-mean);","    float t7 = (d7-mean);","    float t8 = (d8-mean);","    float t9 = (d9-mean);","    float v = (t1*t1+t2*t2+t3*t3+t4*t4+t5*t5+t6*t6+t7*t7+t8*t8+t9*t9)/9.0;","    return v;","  }","","vec2 decodeDepth(vec2 pos)","  {","    vec2 ret;","    ","    ","    float depth1 = sampleDepth(vec2(position.x-1.0, position.y-1.0));","    float depth2 = sampleDepth(vec2(position.x, position.y-1.0));","    float depth3 = sampleDepth(vec2(position.x+1.0, position.y-1.0));","    float depth4 = sampleDepth(vec2(position.x-1.0, position.y));","    float depth5 = sampleDepth(vec2(position.x, position.y));","    float depth6 = sampleDepth(vec2(position.x+1.0, position.y));","    float depth7 = sampleDepth(vec2(position.x-1.0, position.y+1.0));","    float depth8 = sampleDepth(vec2(position.x, position.y+1.0));","    float depth9 = sampleDepth(vec2(position.x+1.0, position.y+1.0));","    ","    float median1 = median(depth1, depth2, depth3);","    float median2 = median(depth4, depth5, depth6);","    float median3 = median(depth7, depth8, depth9);","    ","    ret.x = median(median1, median2, median3);","    ret.y = variance(depth1, depth2, depth3, depth4, depth5, depth6, depth7, depth8, depth9);","    ","    return ret;","    ","  }","","","void main() {","  ","  vUvP = vec2( position.x / (width*2.0), position.y / (height*2.0)+0.5 );","  colorP = vec2( position.x / (width*2.0)+0.5 , position.y / (height*2.0)  );","  ","  vec4 pos = vec4(0.0,0.0,0.0,0.0);","  depthVariance = 0.0;","  ","  if ( (vUvP.x<0.0)|| (vUvP.x>0.5) || (vUvP.y<0.5) || (vUvP.y>0.0))","  {","    vec2 smp = decodeDepth(vec2(position.x, position.y));","    float depth = smp.x;","    depthVariance = smp.y;","    ","    float z = -depth;","    ","    pos = vec4(","      ( position.x / width - 0.5 ) * z * 0.5 * maxDepthPerTile * resolutionFactor * (1000.0/focallength) * -1.0,","      ( position.y / height - 0.5 ) * z * 0.5 * maxDepthPerTile * resolutionFactor * (1000.0/focallength),","      (- z + zOffset / 1000.0) * maxDepthPerTile,","      1.0);","    ","    vec2 maskP = vec2( position.x / (width*2.0), position.y / (height*2.0)  );","    vec4 maskColor = texture2D( map, maskP );","    maskVal = ( maskColor.r + maskColor.g + maskColor.b ) / 3.0 ;","  }","  ","  gl_PointSize = pointSize;","  gl_Position = projectionMatrix * modelViewMatrix * pos;","  ","}"].join("\n"),this.fragment_shader=["uniform sampler2D map;","uniform float varianceThreshold;","uniform float whiteness;","","varying vec2 vUvP;","varying vec2 colorP;","","varying float depthVariance;","varying float maskVal;","","","void main() {","  ","  vec4 color;","  ","  if ( (depthVariance>varianceThreshold) || (maskVal>0.5) ||(vUvP.x<0.0)|| (vUvP.x>0.5) || (vUvP.y<0.5) || (vUvP.y>1.0))","  {  ","    discard;","  }","  else ","  {","    color = texture2D( map, colorP );","    ","    float fader = whiteness /100.0;","    ","    color.r = color.r * (1.0-fader)+ fader;","    ","    color.g = color.g * (1.0-fader)+ fader;","    ","    color.b = color.b * (1.0-fader)+ fader;","    ","    color.a = 1.0;//smoothstep( 20000.0, -20000.0, gl_FragCoord.z / gl_FragCoord.w );","  }","  ","  gl_FragColor = vec4( color.r, color.g, color.b, color.a );","  ","}"].join("\n")}metaLoaded(){this.metaLoaded=!0,this.initStreamer()}initStreamer(){if(this.metaLoaded){this.texture=new h.Texture(this.video);const r=[];for(var e=0,t=this.width*this.height;e<t;e++){var i=new h.Vector3;i.x=e%this.width,i.y=Math.floor(e/this.width),r.push(i)}this.geometry=(new h.BufferGeometry).setFromPoints(r),this.material=new h.ShaderMaterial({uniforms:{map:{type:"t",value:this.texture},width:{type:"f",value:this.width},height:{type:"f",value:this.height},focallength:{type:"f",value:this.f},pointSize:{type:"f",value:this.pointSize},zOffset:{type:"f",value:0},whiteness:{type:"f",value:this.whiteness},varianceThreshold:{type:"f",value:this.varianceThreshold},maxDepthPerTile:{type:"f",value:this.maxDepthPerTile},resolutionFactor:{type:"f",value:this.resolutionFactor}},vertexShader:this.vertex_shader,fragmentShader:this.fragment_shader}),this.mesh=new h.ParticleSystem(this.geometry,this.material),this.mesh.position.x=0,this.mesh.position.y=0,this.add(this.mesh);var s=this;setInterval((function(){(s.isMjpeg||s.video.readyState===s.video.HAVE_ENOUGH_DATA)&&(s.texture.needsUpdate=!0)}),1e3/30)}}startStream(){this.isMjpeg||this.video.play()}stopStream(){this.isMjpeg||this.video.pause()}}class m extends h.Mesh{constructor(e){var t=(e=e||{}).origin||new h.Vector3(0,0,0),i=e.direction||new h.Vector3(1,0,0),r=e.length||1,o=e.headLength||.2,n=e.shaftDiameter||.05,a=e.headDiameter||.1,c=e.material||new h.MeshBasicMaterial,l=r-o,u=new h.CylinderGeometry(.5*n,.5*n,l,12,1),p=new h.Matrix4;p.setPosition(new h.Vector3(0,.5*l,0)),u.applyMatrix4(p);var d=new h.CylinderGeometry(0,.5*a,o,12,1);p.setPosition(new h.Vector3(0,l+.5*o,0)),d.applyMatrix4(p),super(u=s.BufferGeometryUtils.mergeBufferGeometries([u,d]),c),this.position.copy(t),this.setDirection(i)}setDirection(e){var t=new h.Vector3;0===e.x&&0===e.z?t.set(1,0,0):t.set(0,1,0).cross(e);var i=Math.acos(new h.Vector3(0,1,0).dot(e.clone().normalize()));this.matrix=(new h.Matrix4).makeRotationAxis(t.normalize(),i),this.rotation.setFromRotationMatrix(this.matrix,this.rotation.order)}setLength(e){this.scale.set(e,e,e)}setColor(e){this.material.color.setHex(e)}dispose(){void 0!==this.geometry&&this.geometry.dispose(),void 0!==this.material&&this.material.dispose()}}h.STLLoader=function(e){this.manager=void 0!==e?e:h.DefaultLoadingManager},h.STLLoader.prototype={constructor:h.STLLoader,load:function(e,t,i,s){var r=this,o=new h.FileLoader(r.manager);o.setResponseType("arraybuffer"),o.load(e,(function(e){t(r.parse(e))}),i,s)},parse:function(e){var t=function(e){if("string"==typeof e){for(var t=new Uint8Array(e.length),i=0;i<e.length;i++)t[i]=255&e.charCodeAt(i);return t.buffer||t}return e}(e);return function(e){var t;if(50,84+50*(t=new DataView(e)).getUint32(80,!0)===t.byteLength)return!0;for(var i=[115,111,108,105,100],s=0;s<5;s++)if(i[s]!=t.getUint8(s,!1))return!0;return!1}(t)?function(e){for(var t,i,s,r,o,n,a,c,l=new DataView(e),u=l.getUint32(80,!0),p=!1,d=0;d<70;d++)1129270351==l.getUint32(d,!1)&&82==l.getUint8(d+4)&&61==l.getUint8(d+5)&&(p=!0,r=[],o=l.getUint8(d+6)/255,n=l.getUint8(d+7)/255,a=l.getUint8(d+8)/255,c=l.getUint8(d+9)/255);for(var f=new h.BufferGeometry,m=[],v=[],g=0;g<u;g++){var b=84+50*g,y=l.getFloat32(b,!0),w=l.getFloat32(b+4,!0),x=l.getFloat32(b+8,!0);if(p){var _=l.getUint16(b+48,!0);0==(32768&_)?(t=(31&_)/31,i=(_>>5&31)/31,s=(_>>10&31)/31):(t=o,i=n,s=a)}for(var M=1;M<=3;M++){var T=b+12*M;m.push(l.getFloat32(T,!0)),m.push(l.getFloat32(T+4,!0)),m.push(l.getFloat32(T+8,!0)),v.push(y,w,x),p&&r.push(t,i,s)}}return f.setAttribute("position",new h.BufferAttribute(new Float32Array(m),3)),f.setAttribute("normal",new h.BufferAttribute(new Float32Array(v),3)),p&&(f.setAttribute("color",new h.BufferAttribute(new Float32Array(r),3)),f.hasColors=!0,f.alpha=c),f}(t):function(e){for(var t,i=new h.BufferGeometry,s=/facet([\s\S]*?)endfacet/g,r=0,o=/[\s]+([+-]?(?:\d+.\d+|\d+.|\d+|.\d+)(?:[eE][+-]?\d+)?)/.source,n=new RegExp("vertex"+o+o+o,"g"),a=new RegExp("normal"+o+o+o,"g"),c=[],l=[],u=new h.Vector3;null!==(t=s.exec(e));){for(var p=0,d=0,f=t[0];null!==(t=a.exec(f));)u.x=parseFloat(t[1]),u.y=parseFloat(t[2]),u.z=parseFloat(t[3]),d++;for(;null!==(t=n.exec(f));)c.push(parseFloat(t[1]),parseFloat(t[2]),parseFloat(t[3])),l.push(u.x,u.y,u.z),p++;1!==d&&console.error("THREE.STLLoader: Something isn't right with the normal of face number "+r),3!==p&&console.error("THREE.STLLoader: Something isn't right with the vertices of face number "+r),r++}return i.setAttribute("position",new h.Float32BufferAttribute(c,3)),i.setAttribute("normal",new h.Float32BufferAttribute(l,3)),i}(function(e){if("string"!=typeof e){var t=new Uint8Array(e);if(void 0!==window.TextDecoder)return(new TextDecoder).decode(t);for(var i="",s=0,r=e.byteLength;s<r;s++)i+=String.fromCharCode(t[s]);return i}return e}(e))}};var v=/^[og]\s*(.+)?/,g=/^mtllib /,b=/^usemtl /;function y(){var e={objects:[],object:{},vertices:[],normals:[],colors:[],uvs:[],materialLibraries:[],startObject:function(e,t){if(this.object&&!1===this.object.fromDeclaration)return this.object.name=e,void(this.object.fromDeclaration=!1!==t);var i=this.object&&"function"==typeof this.object.currentMaterial?this.object.currentMaterial():void 0;if(this.object&&"function"==typeof this.object._finalize&&this.object._finalize(!0),this.object={name:e||"",fromDeclaration:!1!==t,geometry:{vertices:[],normals:[],colors:[],uvs:[]},materials:[],smooth:!0,startMaterial:function(e,t){var i=this._finalize(!1);i&&(i.inherited||i.groupCount<=0)&&this.materials.splice(i.index,1);var s={index:this.materials.length,name:e||"",mtllib:Array.isArray(t)&&t.length>0?t[t.length-1]:"",smooth:void 0!==i?i.smooth:this.smooth,groupStart:void 0!==i?i.groupEnd:0,groupEnd:-1,groupCount:-1,inherited:!1,clone:function(e){var t={index:"number"==typeof e?e:this.index,name:this.name,mtllib:this.mtllib,smooth:this.smooth,groupStart:0,groupEnd:-1,groupCount:-1,inherited:!1};return t.clone=this.clone.bind(t),t}};return this.materials.push(s),s},currentMaterial:function(){if(this.materials.length>0)return this.materials[this.materials.length-1]},_finalize:function(e){var t=this.currentMaterial();if(t&&-1===t.groupEnd&&(t.groupEnd=this.geometry.vertices.length/3,t.groupCount=t.groupEnd-t.groupStart,t.inherited=!1),e&&this.materials.length>1)for(var i=this.materials.length-1;i>=0;i--)this.materials[i].groupCount<=0&&this.materials.splice(i,1);return e&&0===this.materials.length&&this.materials.push({name:"",smooth:this.smooth}),t}},i&&i.name&&"function"==typeof i.clone){var s=i.clone(0);s.inherited=!0,this.object.materials.push(s)}this.objects.push(this.object)},finalize:function(){this.object&&"function"==typeof this.object._finalize&&this.object._finalize(!0)},parseVertexIndex:function(e,t){var i=parseInt(e,10);return 3*(i>=0?i-1:i+t/3)},parseNormalIndex:function(e,t){var i=parseInt(e,10);return 3*(i>=0?i-1:i+t/3)},parseUVIndex:function(e,t){var i=parseInt(e,10);return 2*(i>=0?i-1:i+t/2)},addVertex:function(e,t,i){var s=this.vertices,r=this.object.geometry.vertices;r.push(s[e+0],s[e+1],s[e+2]),r.push(s[t+0],s[t+1],s[t+2]),r.push(s[i+0],s[i+1],s[i+2])},addVertexPoint:function(e){var t=this.vertices;this.object.geometry.vertices.push(t[e+0],t[e+1],t[e+2])},addVertexLine:function(e){var t=this.vertices;this.object.geometry.vertices.push(t[e+0],t[e+1],t[e+2])},addNormal:function(e,t,i){var s=this.normals,r=this.object.geometry.normals;r.push(s[e+0],s[e+1],s[e+2]),r.push(s[t+0],s[t+1],s[t+2]),r.push(s[i+0],s[i+1],s[i+2])},addColor:function(e,t,i){var s=this.colors,r=this.object.geometry.colors;r.push(s[e+0],s[e+1],s[e+2]),r.push(s[t+0],s[t+1],s[t+2]),r.push(s[i+0],s[i+1],s[i+2])},addUV:function(e,t,i){var s=this.uvs,r=this.object.geometry.uvs;r.push(s[e+0],s[e+1]),r.push(s[t+0],s[t+1]),r.push(s[i+0],s[i+1])},addUVLine:function(e){var t=this.uvs;this.object.geometry.uvs.push(t[e+0],t[e+1])},addFace:function(e,t,i,s,r,o,n,a,c){var h=this.vertices.length,l=this.parseVertexIndex(e,h),u=this.parseVertexIndex(t,h),p=this.parseVertexIndex(i,h);if(this.addVertex(l,u,p),void 0!==s&&""!==s){var d=this.uvs.length;l=this.parseUVIndex(s,d),u=this.parseUVIndex(r,d),p=this.parseUVIndex(o,d),this.addUV(l,u,p)}if(void 0!==n&&""!==n){var f=this.normals.length;l=this.parseNormalIndex(n,f),u=n===a?l:this.parseNormalIndex(a,f),p=n===c?l:this.parseNormalIndex(c,f),this.addNormal(l,u,p)}this.colors.length>0&&this.addColor(l,u,p)},addPointGeometry:function(e){this.object.geometry.type="Points";for(var t=this.vertices.length,i=0,s=e.length;i<s;i++)this.addVertexPoint(this.parseVertexIndex(e[i],t))},addLineGeometry:function(e,t){this.object.geometry.type="Line";for(var i=this.vertices.length,s=this.uvs.length,r=0,o=e.length;r<o;r++)this.addVertexLine(this.parseVertexIndex(e[r],i));var n=0;for(o=t.length;n<o;n++)this.addUVLine(this.parseUVIndex(t[n],s))}};return e.startObject("",!1),e}h.OBJLoader=function(e){this.manager=void 0!==e?e:h.DefaultLoadingManager,this.materials=null},h.OBJLoader.prototype={constructor:h.OBJLoader,load:function(e,t,i,s){var r=this,o=new h.FileLoader(r.manager);o.setPath(this.path),o.load(e,(function(e){t(r.parse(e))}),i,s)},setPath:function(e){return this.path=e,this},setMaterials:function(e){return this.materials=e,this},parse:function(e){console.time("OBJLoader");var t=new y;-1!==e.indexOf("\r\n")&&(e=e.replace(/\r\n/g,"\n")),-1!==e.indexOf("\\\n")&&(e=e.replace(/\\\n/g,""));for(var i=e.split("\n"),s="",r="",o=[],n="function"==typeof"".trimLeft,a=0,c=i.length;a<c;a++)if(s=i[a],0!==(s=n?s.trimLeft():s.trim()).length&&"#"!==(r=s.charAt(0)))if("v"===r){var l=s.split(/\s+/);switch(l[0]){case"v":t.vertices.push(parseFloat(l[1]),parseFloat(l[2]),parseFloat(l[3])),8===l.length&&t.colors.push(parseFloat(l[4]),parseFloat(l[5]),parseFloat(l[6]));break;case"vn":t.normals.push(parseFloat(l[1]),parseFloat(l[2]),parseFloat(l[3]));break;case"vt":t.uvs.push(parseFloat(l[1]),parseFloat(l[2]))}}else if("f"===r){for(var u=s.substr(1).trim().split(/\s+/),p=[],d=0,f=u.length;d<f;d++){var m=u[d];if(m.length>0){var w=m.split("/");p.push(w)}}var x=p[0];for(d=1,f=p.length-1;d<f;d++){var _=p[d],M=p[d+1];t.addFace(x[0],_[0],M[0],x[1],_[1],M[1],x[2],_[2],M[2])}}else if("l"===r){var T=s.substring(1).trim().split(" "),k=[],E=[];if(-1===s.indexOf("/"))k=T;else for(var A=0,C=T.length;A<C;A++){var L=T[A].split("/");""!==L[0]&&k.push(L[0]),""!==L[1]&&E.push(L[1])}t.addLineGeometry(k,E)}else if("p"===r){var N=s.substr(1).trim().split(" ");t.addPointGeometry(N)}else if(null!==(o=v.exec(s))){var j=(" "+o[0].substr(1).trim()).substr(1);t.startObject(j)}else if(b.test(s))t.object.startMaterial(s.substring(7).trim(),t.materialLibraries);else if(g.test(s))t.materialLibraries.push(s.substring(7).trim());else{if("s"!==r){if("\0"===s)continue;throw new Error('THREE.OBJLoader: Unexpected line: "'+s+'"')}if((o=s.split(" ")).length>1){var O=o[1].trim().toLowerCase();t.object.smooth="0"!==O&&"off"!==O}else t.object.smooth=!0;(H=t.object.currentMaterial())&&(H.smooth=t.object.smooth)}t.finalize();var P=new h.Object3D;P.materialLibraries=[].concat(t.materialLibraries);for(a=0,c=t.objects.length;a<c;a++){var R=t.objects[a],S=R.geometry,D=R.materials,V="Line"===S.type,F="Points"===S.type,I=!1;if(0!==S.vertices.length){var z=new h.BufferGeometry;z.setAttribute("position",new h.Float32BufferAttribute(S.vertices,3)),S.normals.length>0?z.setAttribute("normal",new h.Float32BufferAttribute(S.normals,3)):z.computeVertexNormals(),S.colors.length>0&&(I=!0,z.setAttribute("color",new h.Float32BufferAttribute(S.colors,3))),S.uvs.length>0&&z.setAttribute("uv",new h.Float32BufferAttribute(S.uvs,2));for(var U,B=[],G=0,W=D.length;G<W;G++){var q=D[G],H=void 0;if(null!==this.materials)if(H=this.materials.create(q.name),!V||!H||H instanceof h.LineBasicMaterial){if(F&&H&&!(H instanceof h.PointsMaterial)){var K=new h.PointsMaterial({size:10,sizeAttenuation:!1});h.Material.prototype.copy.call(K,H),K.color.copy(H.color),K.map=H.map,K.lights=!1,H=K}}else{var Q=new h.LineBasicMaterial;h.Material.prototype.copy.call(Q,H),Q.color.copy(H.color),Q.lights=!1,H=Q}H||((H=V?new h.LineBasicMaterial:F?new h.PointsMaterial({size:1,sizeAttenuation:!1}):new h.MeshPhongMaterial).name=q.name),H.flatShading=!q.smooth,H.vertexColors=I?h.VertexColors:h.NoColors,B.push(H)}if(B.length>1){for(G=0,W=D.length;G<W;G++){q=D[G];z.addGroup(q.groupStart,q.groupCount,G)}U=V?new h.LineSegments(z,B):F?new h.Points(z,B):new h.Mesh(z,B)}else U=V?new h.LineSegments(z,B[0]):F?new h.Points(z,B[0]):new h.Mesh(z,B[0]);U.name=R.name,P.add(U)}}return console.timeEnd("OBJLoader"),P}},h.MTLLoader=function(e){this.manager=void 0!==e?e:h.DefaultLoadingManager},h.MTLLoader.prototype={constructor:h.MTLLoader,crossOrigin:"anonymous",load:function(e,t,i,s){var r=this,o=void 0===this.path?h.LoaderUtils.extractUrlBase(e):this.path,n=new h.FileLoader(this.manager);n.setPath(this.path),n.load(e,(function(e){t(r.parse(e,o))}),i,s)},setPath:function(e){return this.path=e,this},setResourcePath:function(e){return this.resourcePath=e,this},setTexturePath:function(e){return console.warn("THREE.MTLLoader: .setTexturePath() has been renamed to .setResourcePath()."),this.setResourcePath(e)},setCrossOrigin:function(e){return this.crossOrigin=e,this},setMaterialOptions:function(e){return this.materialOptions=e,this},parse:function(e,t){for(var i=e.split("\n"),s={},r=/\s+/,o={},n=0;n<i.length;n++){var a=i[n];if(0!==(a=a.trim()).length&&"#"!==a.charAt(0)){var c=a.indexOf(" "),l=c>=0?a.substring(0,c):a;l=l.toLowerCase();var u=c>=0?a.substring(c+1):"";if(u=u.trim(),"newmtl"===l)s={name:u},o[u]=s;else if("ka"===l||"kd"===l||"ks"===l||"ke"===l){var p=u.split(r,3);s[l]=[parseFloat(p[0]),parseFloat(p[1]),parseFloat(p[2])]}else s[l]=u}}var d=new h.MTLLoader.MaterialCreator(this.resourcePath||t,this.materialOptions);return d.setCrossOrigin(this.crossOrigin),d.setManager(this.manager),d.setMaterials(o),d}},h.MTLLoader.MaterialCreator=function(e,t){this.baseUrl=e||"",this.options=t,this.materialsInfo={},this.materials={},this.materialsArray=[],this.nameLookup={},this.side=this.options&&this.options.side?this.options.side:h.FrontSide,this.wrap=this.options&&this.options.wrap?this.options.wrap:h.RepeatWrapping},h.MTLLoader.MaterialCreator.prototype={constructor:h.MTLLoader.MaterialCreator,crossOrigin:"anonymous",setCrossOrigin:function(e){return this.crossOrigin=e,this},setManager:function(e){this.manager=e},setMaterials:function(e){this.materialsInfo=this.convert(e),this.materials={},this.materialsArray=[],this.nameLookup={}},convert:function(e){if(!this.options)return e;var t={};for(var i in e){var s=e[i],r={};for(var o in t[i]=r,s){var n=!0,a=s[o],c=o.toLowerCase();switch(c){case"kd":case"ka":case"ks":this.options&&this.options.normalizeRGB&&(a=[a[0]/255,a[1]/255,a[2]/255]),this.options&&this.options.ignoreZeroRGBs&&0===a[0]&&0===a[1]&&0===a[2]&&(n=!1)}n&&(r[c]=a)}}return t},preload:function(){for(var e in this.materialsInfo)this.create(e)},getIndex:function(e){return this.nameLookup[e]},getAsArray:function(){var e=0;for(var t in this.materialsInfo)this.materialsArray[e]=this.create(t),this.nameLookup[t]=e,e++;return this.materialsArray},create:function(e){return void 0===this.materials[e]&&this.createMaterial_(e),this.materials[e]},createMaterial_:function(e){var t=this,i=this.materialsInfo[e],s={name:e,side:this.side};function r(e,i){if(!s[e]){var r,o,n=t.getTextureParams(i,s),a=t.loadTexture((r=t.baseUrl,"string"!=typeof(o=n.url)||""===o?"":/^https?:\/\//i.test(o)?o:r+o));a.repeat.copy(n.scale),a.offset.copy(n.offset),a.wrapS=t.wrap,a.wrapT=t.wrap,s[e]=a}}for(var o in i){var n,a=i[o];if(""!==a)switch(o.toLowerCase()){case"kd":s.color=(new h.Color).fromArray(a);break;case"ks":s.specular=(new h.Color).fromArray(a);break;case"ke":s.emissive=(new h.Color).fromArray(a);break;case"map_kd":r("map",a);break;case"map_ks":r("specularMap",a);break;case"map_ke":r("emissiveMap",a);break;case"norm":r("normalMap",a);break;case"map_bump":case"bump":r("bumpMap",a);break;case"map_d":r("alphaMap",a),s.transparent=!0;break;case"ns":s.shininess=parseFloat(a);break;case"d":(n=parseFloat(a))<1&&(s.opacity=n,s.transparent=!0);break;case"tr":n=parseFloat(a),this.options&&this.options.invertTrProperty&&(n=1-n),n>0&&(s.opacity=1-n,s.transparent=!0)}}return this.materials[e]=new h.MeshPhongMaterial(s),this.materials[e]},getTextureParams:function(e,t){var i,s={scale:new h.Vector2(1,1),offset:new h.Vector2(0,0)},r=e.split(/\s+/);return(i=r.indexOf("-bm"))>=0&&(t.bumpScale=parseFloat(r[i+1]),r.splice(i,2)),(i=r.indexOf("-s"))>=0&&(s.scale.set(parseFloat(r[i+1]),parseFloat(r[i+2])),r.splice(i,4)),(i=r.indexOf("-o"))>=0&&(s.offset.set(parseFloat(r[i+1]),parseFloat(r[i+2])),r.splice(i,4)),s.url=r.join(" ").trim(),s},loadTexture:function(e,t,i,s,r){var o,n=h.Loader.Handlers.get(e),a=void 0!==this.manager?this.manager:h.DefaultLoadingManager;return null===n&&(n=new h.TextureLoader(a)),n.setCrossOrigin&&n.setCrossOrigin(this.crossOrigin),o=n.load(e,i,s,r),void 0!==t&&(o.mapping=t),o}},h.ColladaLoader=function(e){this.manager=void 0!==e?e:h.DefaultLoadingManager},h.ColladaLoader.prototype={constructor:h.ColladaLoader,crossOrigin:"Anonymous",load:function(e,t,i,s){var r=this,o=h.LoaderUtils.extractUrlBase(e);new h.FileLoader(r.manager).load(e,(function(e){t(r.parse(e,o))}),i,s)},options:{set convertUpAxis(e){console.warn("THREE.ColladaLoader: options.convertUpAxis() has been removed. Up axis is converted automatically.")}},setCrossOrigin:function(e){this.crossOrigin=e},parse:function(e,t){function i(e,t){for(var i=[],s=e.childNodes,r=0,o=s.length;r<o;r++){var n=s[r];n.nodeName===t&&i.push(n)}return i}function s(e){if(0===e.length)return[];for(var t=e.trim().split(/\s+/),i=new Array(t.length),s=0,r=t.length;s<r;s++)i[s]=t[s];return i}function r(e){if(0===e.length)return[];for(var t=e.trim().split(/\s+/),i=new Array(t.length),s=0,r=t.length;s<r;s++)i[s]=parseFloat(t[s]);return i}function o(e){if(0===e.length)return[];for(var t=e.trim().split(/\s+/),i=new Array(t.length),s=0,r=t.length;s<r;s++)i[s]=parseInt(t[s]);return i}function n(e){return e.substring(1)}function a(e){return 0===Object.keys(e).length}function c(e){return void 0!==e?parseFloat(e.getAttribute("meter")):1}function l(e){return void 0!==e?e.textContent:"Y_UP"}function u(e,t,s,r){var o=i(e,t)[0];if(void 0!==o)for(var n=i(o,s),a=0;a<n.length;a++)r(n[a])}function p(e,t){for(var i in e){e[i].build=t(e[i])}}function d(e,t){return void 0!==e.build||(e.build=t(e)),e.build}function f(e){for(var t={inputs:{}},i=0,s=e.childNodes.length;i<s;i++){var r=e.childNodes[i];if(1===r.nodeType)switch(r.nodeName){case"input":var o=n(r.getAttribute("source")),a=r.getAttribute("semantic");t.inputs[a]=o}}return t}function m(e){var t={},i=e.getAttribute("target").split("/"),s=i.shift(),r=i.shift(),o=-1!==r.indexOf("("),a=-1!==r.indexOf(".");if(a)i=r.split("."),r=i.shift(),t.member=i.shift();else if(o){var c=r.split("(");r=c.shift();for(var h=0;h<c.length;h++)c[h]=parseInt(c[h].replace(/\)/,""));t.indices=c}return t.id=s,t.sid=r,t.arraySyntax=o,t.memberSyntax=a,t.sampler=n(e.getAttribute("source")),t}function v(e){var t=[],i=e.channels,s=e.samplers,r=e.sources;for(var o in i)if(i.hasOwnProperty(o)){var n=i[o],a=s[n.sampler],c=a.inputs.INPUT,h=a.inputs.OUTPUT;_(b(n,r[c],r[h]),t)}return t}function g(e){return d(Ve.animations[e],v)}function b(e,t,i){var s,r,o,n,a,c,h=Ve.nodes[e.id],l=Ee(h.id),u=h.transforms[e.sid],p=h.matrix.clone().transpose(),d={};switch(u){case"matrix":for(o=0,n=t.array.length;o<n;o++)if(s=t.array[o],r=o*i.stride,void 0===d[s]&&(d[s]={}),!0===e.arraySyntax){var f=i.array[r],m=e.indices[0]+4*e.indices[1];d[s][m]=f}else for(a=0,c=i.stride;a<c;a++)d[s][a]=i.array[r+a];break;case"translate":case"rotate":case"scale":console.warn('THREE.ColladaLoader: Animation transform type "%s" not yet implemented.',u)}var v=function(e,t){var i=[];for(var s in e)i.push({time:parseFloat(s),value:e[s]});i.sort(o);for(var r=0;r<16;r++)M(i,r,t.elements[r]);return i;function o(e,t){return e.time-t.time}}(d,p);return{name:l.uuid,keyframes:v}}var y=new h.Vector3,w=new h.Vector3,x=new h.Quaternion;function _(e,t){for(var i=e.keyframes,s=e.name,r=[],o=[],n=[],a=[],c=0,l=i.length;c<l;c++){var u=i[c],p=u.time,d=u.value;ge.fromArray(d).transpose(),ge.decompose(y,x,w),r.push(p),o.push(y.x,y.y,y.z),n.push(x.x,x.y,x.z,x.w),a.push(w.x,w.y,w.z)}return o.length>0&&t.push(new h.VectorKeyframeTrack(s+".position",r,o)),n.length>0&&t.push(new h.QuaternionKeyframeTrack(s+".quaternion",r,n)),a.length>0&&t.push(new h.VectorKeyframeTrack(s+".scale",r,a)),t}function M(e,t,i){var s,r,o,n=!0;for(r=0,o=e.length;r<o;r++)void 0===(s=e[r]).value[t]?s.value[t]=null:n=!1;if(!0===n)for(r=0,o=e.length;r<o;r++)(s=e[r]).value[t]=i;else!function(e,t){for(var i,s,r=0,o=e.length;r<o;r++){var n=e[r];if(null===n.value[t]){if(i=T(e,r,t),s=k(e,r,t),null===i){n.value[t]=s.value[t];continue}if(null===s){n.value[t]=i.value[t];continue}E(n,i,s,t)}}}(e,t)}function T(e,t,i){for(;t>=0;){var s=e[t];if(null!==s.value[i])return s;t--}return null}function k(e,t,i){for(;t<e.length;){var s=e[t];if(null!==s.value[i])return s;t++}return null}function E(e,t,i,s){i.time-t.time!=0?e.value[s]=(e.time-t.time)*(i.value[s]-t.value[s])/(i.time-t.time)+t.value[s]:e.value[s]=t.value[s]}function A(e){for(var t=[],i=e.name,s=e.end-e.start||-1,r=e.animations,o=0,n=r.length;o<n;o++)for(var a=g(r[o]),c=0,l=a.length;c<l;c++)t.push(a[c]);return new h.AnimationClip(i,s,t)}function C(e){return d(Ve.clips[e],A)}function L(e){for(var t={sources:{}},i=0,s=e.childNodes.length;i<s;i++){var o=e.childNodes[i];if(1===o.nodeType)switch(o.nodeName){case"bind_shape_matrix":t.bindShapeMatrix=r(o.textContent);break;case"source":var n=o.getAttribute("id");t.sources[n]=ee(o);break;case"joints":t.joints=N(o);break;case"vertex_weights":t.vertexWeights=j(o)}}return t}function N(e){for(var t={inputs:{}},i=0,s=e.childNodes.length;i<s;i++){var r=e.childNodes[i];if(1===r.nodeType)switch(r.nodeName){case"input":var o=r.getAttribute("semantic"),a=n(r.getAttribute("source"));t.inputs[o]=a}}return t}function j(e){for(var t={inputs:{}},i=0,s=e.childNodes.length;i<s;i++){var r=e.childNodes[i];if(1===r.nodeType)switch(r.nodeName){case"input":var a=r.getAttribute("semantic"),c=n(r.getAttribute("source")),h=parseInt(r.getAttribute("offset"));t.inputs[a]={id:c,offset:h};break;case"vcount":t.vcount=o(r.textContent);break;case"v":t.v=o(r.textContent)}}return t}function O(e){var t={id:e.id},i=Ve.geometries[t.id];return void 0!==e.skin&&(t.skin=function(e){var t,i,s,r=4,o={joints:[],indices:{array:[],stride:r},weights:{array:[],stride:r}},n=e.sources,a=e.vertexWeights,c=a.vcount,l=a.v,u=a.inputs.JOINT.offset,p=a.inputs.WEIGHT.offset,d=e.sources[e.joints.inputs.JOINT],f=e.sources[e.joints.inputs.INV_BIND_MATRIX],m=n[a.inputs.WEIGHT.id].array,v=0;for(t=0,s=c.length;t<s;t++){var g=c[t],b=[];for(i=0;i<g;i++){var y=l[v+u],w=m[l[v+p]];b.push({index:y,weight:w}),v+=2}for(b.sort(T),i=0;i<r;i++){var x=b[i];void 0!==x?(o.indices.array.push(x.index),o.weights.array.push(x.weight)):(o.indices.array.push(0),o.weights.array.push(0))}}for(o.bindMatrix=(new h.Matrix4).fromArray(e.bindShapeMatrix).transpose(),t=0,s=d.array.length;t<s;t++){var _=d.array[t],M=(new h.Matrix4).fromArray(f.array,t*f.stride).transpose();o.joints.push({name:_,boneInverse:M})}return o;function T(e,t){return t.weight-e.weight}}(e.skin),i.sources.skinIndices=t.skin.indices,i.sources.skinWeights=t.skin.weights),t}function P(e){return void 0!==e.build?e.build:e.init_from}function R(e){for(var t={surfaces:{},samplers:{}},i=0,s=e.childNodes.length;i<s;i++){var r=e.childNodes[i];if(1===r.nodeType)switch(r.nodeName){case"newparam":S(r,t);break;case"technique":t.technique=F(r)}}return t}function S(e,t){for(var i=e.getAttribute("sid"),s=0,r=e.childNodes.length;s<r;s++){var o=e.childNodes[s];if(1===o.nodeType)switch(o.nodeName){case"surface":t.surfaces[i]=D(o);break;case"sampler2D":t.samplers[i]=V(o)}}}function D(e){for(var t={},i=0,s=e.childNodes.length;i<s;i++){var r=e.childNodes[i];if(1===r.nodeType)switch(r.nodeName){case"init_from":t.init_from=r.textContent}}return t}function V(e){for(var t={},i=0,s=e.childNodes.length;i<s;i++){var r=e.childNodes[i];if(1===r.nodeType)switch(r.nodeName){case"source":t.source=r.textContent}}return t}function F(e){for(var t={},i=0,s=e.childNodes.length;i<s;i++){var r=e.childNodes[i];if(1===r.nodeType)switch(r.nodeName){case"constant":case"lambert":case"blinn":case"phong":t.type=r.nodeName,t.parameters=I(r)}}return t}function I(e){for(var t={},i=0,s=e.childNodes.length;i<s;i++){var r=e.childNodes[i];if(1===r.nodeType)switch(r.nodeName){case"emission":case"diffuse":case"specular":case"shininess":case"transparent":case"transparency":t[r.nodeName]=z(r)}}return t}function z(e){for(var t={},i=0,s=e.childNodes.length;i<s;i++){var o=e.childNodes[i];if(1===o.nodeType)switch(o.nodeName){case"color":t[o.nodeName]=r(o.textContent);break;case"float":t[o.nodeName]=parseFloat(o.textContent);break;case"texture":t[o.nodeName]={id:o.getAttribute("texture"),extra:U(o)}}}return t}function U(e){for(var t={technique:{}},i=0,s=e.childNodes.length;i<s;i++){var r=e.childNodes[i];if(1===r.nodeType)switch(r.nodeName){case"extra":B(r,t)}}return t}function B(e,t){for(var i=0,s=e.childNodes.length;i<s;i++){var r=e.childNodes[i];if(1===r.nodeType)switch(r.nodeName){case"technique":G(r,t)}}}function G(e,t){for(var i=0,s=e.childNodes.length;i<s;i++){var r=e.childNodes[i];if(1===r.nodeType)switch(r.nodeName){case"repeatU":case"repeatV":case"offsetU":case"offsetV":t.technique[r.nodeName]=parseFloat(r.textContent);break;case"wrapU":case"wrapV":"TRUE"===r.textContent.toUpperCase()?t.technique[r.nodeName]=1:"FALSE"===r.textContent.toUpperCase()?t.technique[r.nodeName]=0:t.technique[r.nodeName]=parseInt(r.textContent)}}}function W(e){return e}function q(e){var t,i,s=(t=e.url,d(Ve.effects[t],W)),r=s.profile.technique;switch(r.type){case"phong":case"blinn":i=new h.MeshPhongMaterial;break;case"lambert":i=new h.MeshLambertMaterial;break;default:i=new h.MeshBasicMaterial}function o(e){var t=s.profile.samplers[e.id];if(void 0!==t){var i=s.profile.surfaces[t.source],r=Pe.load(function(e){return d(Ve.images[e],P)}(i.init_from)),o=e.extra;if(void 0!==o&&void 0!==o.technique&&!1===a(o.technique)){var n=o.technique;r.wrapS=n.wrapU?h.RepeatWrapping:h.ClampToEdgeWrapping,r.wrapT=n.wrapV?h.RepeatWrapping:h.ClampToEdgeWrapping,r.offset.set(n.offsetU||0,n.offsetV||0),r.repeat.set(n.repeatU||1,n.repeatV||1)}else r.wrapS=h.RepeatWrapping,r.wrapT=h.RepeatWrapping;return r}return console.error("THREE.ColladaLoader: Undefined sampler",e.id),null}i.name=e.name;var n=r.parameters;for(var c in n){var l=n[c];switch(c){case"diffuse":l.color&&i.color.fromArray(l.color),l.texture&&(i.map=o(l.texture));break;case"specular":l.color&&i.specular&&i.specular.fromArray(l.color),l.texture&&(i.specularMap=o(l.texture));break;case"shininess":l.float&&i.shininess&&(i.shininess=l.float);break;case"emission":l.color&&i.emissive&&i.emissive.fromArray(l.color);break;case"transparent":i.transparent=!0;break;case"transparency":void 0!==l.float&&(i.opacity=l.float),i.transparent=!0}}return i}function H(e){return d(Ve.materials[e],q)}function K(e){for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];switch(i.nodeName){case"technique_common":return Q(i)}}return{}}function Q(e){for(var t={},i=0;i<e.childNodes.length;i++){var s=e.childNodes[i];switch(s.nodeName){case"perspective":case"orthographic":t.technique=s.nodeName,t.parameters=X(s)}}return t}function X(e){for(var t={},i=0;i<e.childNodes.length;i++){var s=e.childNodes[i];switch(s.nodeName){case"xfov":case"yfov":case"xmag":case"ymag":case"znear":case"zfar":case"aspect_ratio":t[s.nodeName]=parseFloat(s.textContent)}}return t}function Y(e){var t;switch(e.optics.technique){case"perspective":t=new h.PerspectiveCamera(e.optics.parameters.yfov,e.optics.parameters.aspect_ratio,e.optics.parameters.znear,e.optics.parameters.zfar);break;case"orthographic":var i=e.optics.parameters.ymag,s=e.optics.parameters.xmag,r=e.optics.parameters.aspect_ratio;s=void 0===s?i*r:s,i=void 0===i?s/r:i,s*=.5,i*=.5,t=new h.OrthographicCamera(-s,s,i,-i,e.optics.parameters.znear,e.optics.parameters.zfar);break;default:t=new h.PerspectiveCamera}return t.name=e.name,t}function Z(e){var t=Ve.cameras[e];return void 0!==t?d(t,Y):null}function J(e){for(var t={},i=0,s=e.childNodes.length;i<s;i++){var r=e.childNodes[i];if(1===r.nodeType)switch(r.nodeName){case"directional":case"point":case"spot":case"ambient":t.technique=r.nodeName,t.parameters=$(r)}}return t}function $(e){for(var t={},i=0,s=e.childNodes.length;i<s;i++){var o=e.childNodes[i];if(1===o.nodeType)switch(o.nodeName){case"color":var n=r(o.textContent);t.color=(new h.Color).fromArray(n);break;case"falloff_angle":t.falloffAngle=parseFloat(o.textContent);break;case"quadratic_attenuation":var a=parseFloat(o.textContent);t.distance=a?Math.sqrt(1/a):0}}return t}function ee(e){for(var t={array:[],stride:3},o=0;o<e.childNodes.length;o++){var n=e.childNodes[o];if(1===n.nodeType)switch(n.nodeName){case"float_array":t.array=r(n.textContent);break;case"Name_array":t.array=s(n.textContent);break;case"technique_common":var a=i(n,"accessor")[0];void 0!==a&&(t.stride=parseInt(a.getAttribute("stride")))}}return t}function te(e){for(var t={},i=0;i<e.childNodes.length;i++){var s=e.childNodes[i];1===s.nodeType&&(t[s.getAttribute("semantic")]=n(s.getAttribute("source")))}return t}function ie(e){for(var t={type:e.nodeName,material:e.getAttribute("material"),count:parseInt(e.getAttribute("count")),inputs:{},stride:0},i=0,s=e.childNodes.length;i<s;i++){var r=e.childNodes[i];if(1===r.nodeType)switch(r.nodeName){case"input":var a=n(r.getAttribute("source")),c=r.getAttribute("semantic"),h=parseInt(r.getAttribute("offset"));t.inputs[c]={id:a,offset:h},t.stride=Math.max(t.stride,h+1);break;case"vcount":t.vcount=o(r.textContent);break;case"p":t.p=o(r.textContent)}}return t}function se(e){var t={},i=e.sources,s=e.vertices,r=e.primitives;if(0===r.length)return{};var o=function(e){for(var t={},i=0;i<e.length;i++){var s=e[i];void 0===t[s.type]&&(t[s.type]=[]),t[s.type].push(s)}return t}(r);for(var n in o)t[n]=re(o[n],i,s);return t}function re(e,t,i){for(var s={},r={array:[],stride:0},o={array:[],stride:0},n={array:[],stride:0},a={array:[],stride:0},c=[],l=4,u=[],p=4,d=new h.BufferGeometry,f=[],m=0,v=0,g=0;g<e.length;g++){var b=e[g],y=b.inputs,w=1;for(var x in b.vcount&&4===b.vcount[0]&&(w=2),v="lines"===b.type||"linestrips"===b.type?2*b.count:3*b.count*w,d.addGroup(m,v,g),m+=v,b.material&&f.push(b.material),y){var _=y[x];switch(x){case"VERTEX":for(var M in i){var T=i[M];switch(M){case"POSITION":oe(b,t[T],_.offset,r.array),r.stride=t[T].stride,t.skinWeights&&t.skinIndices&&(oe(b,t.skinIndices,_.offset,c),oe(b,t.skinWeights,_.offset,u));break;case"NORMAL":oe(b,t[T],_.offset,o.array),o.stride=t[T].stride;break;case"COLOR":oe(b,t[T],_.offset,a.array),a.stride=t[T].stride;break;case"TEXCOORD":oe(b,t[T],_.offset,n.array),n.stride=t[T].stride;break;default:console.warn('THREE.ColladaLoader: Semantic "%s" not handled in geometry build process.',M)}}break;case"NORMAL":oe(b,t[_.id],_.offset,o.array),o.stride=t[_.id].stride;break;case"COLOR":oe(b,t[_.id],_.offset,a.array),a.stride=t[_.id].stride;break;case"TEXCOORD":oe(b,t[_.id],_.offset,n.array),n.stride=t[_.id].stride}}}return r.array.length>0&&d.setAttribute("position",new h.Float32BufferAttribute(r.array,r.stride)),o.array.length>0&&d.setAttribute("normal",new h.Float32BufferAttribute(o.array,o.stride)),a.array.length>0&&d.setAttribute("color",new h.Float32BufferAttribute(a.array,a.stride)),n.array.length>0&&d.setAttribute("uv",new h.Float32BufferAttribute(n.array,n.stride)),c.length>0&&d.setAttribute("skinIndex",new h.Float32BufferAttribute(c,l)),u.length>0&&d.setAttribute("skinWeight",new h.Float32BufferAttribute(u,p)),s.data=d,s.type=e[0].type,s.materialKeys=f,s}function oe(e,t,i,s){var r=e.p,o=e.stride,n=e.vcount;function a(e){for(var t=r[e+i]*l,o=t+l;t<o;t++)s.push(h[t])}var c=0,h=t.array,l=t.stride;if(void 0!==e.vcount){for(var u=0,p=0,d=n.length;p<d;p++){var f=n[p];if(4===f){var m=u+1*o,v=u+2*o,g=u+3*o;a(u+0*o),a(m),a(g),a(m),a(v),a(g)}else if(3===f){m=u+1*o,v=u+2*o;a(u+0*o),a(m),a(v)}else c=Math.max(c,f);u+=o*f}c>0&&console.log("THREE.ColladaLoader: Geometry has faces with more than 4 vertices.")}else for(p=0,d=r.length;p<d;p+=o)a(p)}function ne(e){return d(Ve.geometries[e],se)}function ae(e){return void 0!==e.build?e.build:e}function ce(e,t){for(var i=0;i<e.childNodes.length;i++){var s=e.childNodes[i];if(1===s.nodeType)switch(s.nodeName){case"joint":t.joints[s.getAttribute("sid")]=he(s);break;case"link":t.links.push(ue(s))}}}function he(e){for(var t,i=0;i<e.childNodes.length;i++){var s=e.childNodes[i];if(1===s.nodeType)switch(s.nodeName){case"prismatic":case"revolute":t=le(s)}}return t}function le(e,t){t={sid:e.getAttribute("sid"),name:e.getAttribute("name")||"",axis:new h.Vector3,limits:{min:0,max:0},type:e.nodeName,static:!1,zeroPosition:0,middlePosition:0};for(var i=0;i<e.childNodes.length;i++){var s=e.childNodes[i];if(1===s.nodeType)switch(s.nodeName){case"axis":var o=r(s.textContent);t.axis.fromArray(o);break;case"limits":var n=s.getElementsByTagName("max")[0],a=s.getElementsByTagName("min")[0];t.limits.max=parseFloat(n.textContent),t.limits.min=parseFloat(a.textContent)}}return t.limits.min>=t.limits.max&&(t.static=!0),t.middlePosition=(t.limits.min+t.limits.max)/2,t}function ue(e){for(var t={sid:e.getAttribute("sid"),name:e.getAttribute("name")||"",attachments:[],transforms:[]},i=0;i<e.childNodes.length;i++){var s=e.childNodes[i];if(1===s.nodeType)switch(s.nodeName){case"attachment_full":t.attachments.push(pe(s));break;case"matrix":case"translate":case"rotate":t.transforms.push(de(s))}}return t}function pe(e){for(var t={joint:e.getAttribute("joint").split("/").pop(),transforms:[],links:[]},i=0;i<e.childNodes.length;i++){var s=e.childNodes[i];if(1===s.nodeType)switch(s.nodeName){case"link":t.links.push(ue(s));break;case"matrix":case"translate":case"rotate":t.transforms.push(de(s))}}return t}function de(e){var t={type:e.nodeName},i=r(e.textContent);switch(t.type){case"matrix":t.obj=new h.Matrix4,t.obj.fromArray(i).transpose();break;case"translate":t.obj=new h.Vector3,t.obj.fromArray(i);break;case"rotate":t.obj=new h.Vector3,t.obj.fromArray(i),t.angle=h.Math.degToRad(i[3])}return t}function fe(e){for(var t={target:e.getAttribute("target").split("/").pop()},i=0;i<e.childNodes.length;i++){var s=e.childNodes[i];if(1===s.nodeType)switch(s.nodeName){case"axis":var r=s.getElementsByTagName("param")[0];t.axis=r.textContent;var o=t.axis.split("inst_").pop().split("axis")[0];t.jointIndex=o.substr(0,o.length-1)}}return t}function me(e){return void 0!==e.build?e.build:e}function ve(e){for(var t=[],i=Ne.querySelector('[id="'+e.id+'"]'),s=0;s<i.childNodes.length;s++){var o=i.childNodes[s];if(1===o.nodeType)switch(o.nodeName){case"matrix":var n=r(o.textContent),a=(new h.Matrix4).fromArray(n).transpose();t.push({sid:o.getAttribute("sid"),type:o.nodeName,obj:a});break;case"translate":case"scale":n=r(o.textContent);var c=(new h.Vector3).fromArray(n);t.push({sid:o.getAttribute("sid"),type:o.nodeName,obj:c});break;case"rotate":n=r(o.textContent),c=(new h.Vector3).fromArray(n);var l=h.Math.degToRad(n[3]);t.push({sid:o.getAttribute("sid"),type:o.nodeName,obj:c,angle:l})}}return t}var ge=new h.Matrix4,be=new h.Vector3;function ye(e){for(var t={name:e.getAttribute("name")||"",type:e.getAttribute("type"),id:e.getAttribute("id"),sid:e.getAttribute("sid"),matrix:new h.Matrix4,nodes:[],instanceCameras:[],instanceControllers:[],instanceLights:[],instanceGeometries:[],instanceNodes:[],transforms:{}},i=0;i<e.childNodes.length;i++){var s=e.childNodes[i];if(1===s.nodeType)switch(s.nodeName){case"node":t.nodes.push(s.getAttribute("id")),ye(s);break;case"instance_camera":t.instanceCameras.push(n(s.getAttribute("url")));break;case"instance_controller":t.instanceControllers.push(we(s));break;case"instance_light":t.instanceLights.push(n(s.getAttribute("url")));break;case"instance_geometry":t.instanceGeometries.push(we(s));break;case"instance_node":t.instanceNodes.push(n(s.getAttribute("url")));break;case"matrix":var o=r(s.textContent);t.matrix.multiply(ge.fromArray(o).transpose()),t.transforms[s.getAttribute("sid")]=s.nodeName;break;case"translate":o=r(s.textContent);be.fromArray(o),t.matrix.multiply(ge.makeTranslation(be.x,be.y,be.z)),t.transforms[s.getAttribute("sid")]=s.nodeName;break;case"rotate":o=r(s.textContent);var a=h.Math.degToRad(o[3]);t.matrix.multiply(ge.makeRotationAxis(be.fromArray(o),a)),t.transforms[s.getAttribute("sid")]=s.nodeName;break;case"scale":o=r(s.textContent);t.matrix.scale(be.fromArray(o)),t.transforms[s.getAttribute("sid")]=s.nodeName;break;case"extra":break;default:console.log(s)}}return Ve.nodes[t.id]=t,t}function we(e){for(var t={id:n(e.getAttribute("url")),materials:{},skeletons:[]},i=0;i<e.childNodes.length;i++){var s=e.childNodes[i];switch(s.nodeName){case"bind_material":for(var r=s.getElementsByTagName("instance_material"),o=0;o<r.length;o++){var a=r[o],c=a.getAttribute("symbol"),h=a.getAttribute("target");t.materials[c]=n(h)}break;case"skeleton":t.skeletons.push(n(s.textContent))}}return t}function xe(e,t){var i,s,r,o=[],n=[];for(i=0;i<e.length;i++){_e(Ee(e[i]),t,o)}for(i=0;i<t.length;i++)for(s=0;s<o.length;s++)if((r=o[s]).bone.name===t[i].name){n[i]=r,r.processed=!0;break}for(i=0;i<o.length;i++)!1===(r=o[i]).processed&&(n.push(r),r.processed=!0);var a=[],c=[];for(i=0;i<n.length;i++)r=n[i],a.push(r.bone),c.push(r.boneInverse);return new h.Skeleton(a,c)}function _e(e,t,i){e.traverse((function(e){if(!0===e.isBone){for(var s,r=0;r<t.length;r++){var o=t[r];if(o.name===e.name){s=o.boneInverse;break}}void 0===s&&(s=new h.Matrix4),i.push({bone:e,boneInverse:s,processed:!1})}}))}function Me(e){for(var t,i=[],s=e.matrix,r=e.nodes,o=e.type,n=e.instanceCameras,a=e.instanceControllers,c=e.instanceLights,l=e.instanceGeometries,u=e.instanceNodes,p=0,f=r.length;p<f;p++)i.push(Ee(r[p]));for(p=0,f=n.length;p<f;p++){null!==(_=Z(n[p]))&&i.push(_.clone())}for(p=0,f=a.length;p<f;p++)for(var m=a[p],v=(t=m.id,d(Ve.controllers[t],O)),g=ke(ne(v.id),m.materials),b=xe(m.skeletons,v.skin.joints),y=0,w=g.length;y<w;y++){var x;(x=g[y]).isSkinnedMesh&&(x.bind(b,v.skin.bindMatrix),x.normalizeSkinWeights()),i.push(x)}for(p=0,f=c.length;p<f;p++){var _;null!==(_=Z(n[p]))&&i.push(_.clone())}for(p=0,f=l.length;p<f;p++)for(y=0,w=(g=ke(ne((m=l[p]).id),m.materials)).length;y<w;y++)i.push(g[y]);for(p=0,f=u.length;p<f;p++)i.push(Ee(u[p]).clone());if(0===r.length&&1===i.length)x=i[0];else{x="JOINT"===o?new h.Bone:new h.Object3D;for(p=0;p<i.length;p++)x.add(i[p])}return x.name="JOINT"===o?e.sid:e.name,x.matrix.copy(s),x.matrix.decompose(x.position,x.quaternion,x.scale),x}function Te(e,t){for(var i=[],s=0,r=e.length;s<r;s++){var o=t[e[s]];i.push(H(o))}return i}function ke(e,t){var i=[];for(var s in e){var r=e[s],o=Te(r.materialKeys,t);0===o.length&&("lines"===s||"linestrips"===s?o.push(new h.LineBasicMaterial):o.push(new h.MeshPhongMaterial));var n=void 0!==r.data.attributes.skinIndex;if(n)for(var a=0,c=o.length;a<c;a++)o[a].skinning=!0;var l,u=1===o.length?o[0]:o;switch(s){case"lines":l=new h.LineSegments(r.data,u);break;case"linestrips":l=new h.Line(r.data,u);break;case"triangles":case"polylist":l=n?new h.SkinnedMesh(r.data,u):new h.Mesh(r.data,u)}i.push(l)}return i}function Ee(e){return d(Ve.nodes[e],Me)}function Ae(e){var t=new h.Object3D;t.name=e.name;for(var i=e.children,s=0;s<i.length;s++){var r=i[s];null===r.id?t.add(Me(r)):t.add(Ee(r.id))}return t}function Ce(e){return d(Ve.visualScenes[e],Ae)}if(console.time("THREE.ColladaLoader"),0===e.length)return{scene:new h.Scene};console.time("THREE.ColladaLoader: DOMParser");var Le=(new DOMParser).parseFromString(e,"application/xml");console.timeEnd("THREE.ColladaLoader: DOMParser");var Ne=i(Le,"COLLADA")[0],je=Ne.getAttribute("version");console.log("THREE.ColladaLoader: File version",je);var Oe=function(e){return{unit:c(i(e,"unit")[0]),upAxis:l(i(e,"up_axis")[0])}}(i(Ne,"asset")[0]),Pe=new h.TextureLoader(this.manager);Pe.setPath(t).setCrossOrigin(this.crossOrigin);var Re=[],Se={},De=0,Ve={animations:{},clips:{},controllers:{},images:{},effects:{},materials:{},cameras:{},lights:{},geometries:{},nodes:{},visualScenes:{},kinematicsModels:{},kinematicsScenes:{}};console.time("THREE.ColladaLoader: Parse"),u(Ne,"library_animations","animation",(function(e){for(var t={sources:{},samplers:{},channels:{}},i=0,s=e.childNodes.length;i<s;i++){var r,o=e.childNodes[i];if(1===o.nodeType)switch(o.nodeName){case"source":r=o.getAttribute("id"),t.sources[r]=ee(o);break;case"sampler":r=o.getAttribute("id"),t.samplers[r]=f(o);break;case"channel":r=o.getAttribute("target"),t.channels[r]=m(o);break;default:console.log(o)}}Ve.animations[e.getAttribute("id")]=t})),u(Ne,"library_animation_clips","animation_clip",(function(e){for(var t={name:e.getAttribute("id")||"default",start:parseFloat(e.getAttribute("start")||0),end:parseFloat(e.getAttribute("end")||0),animations:[]},i=0,s=e.childNodes.length;i<s;i++){var r=e.childNodes[i];if(1===r.nodeType)switch(r.nodeName){case"instance_animation":t.animations.push(n(r.getAttribute("url")))}}Ve.clips[e.getAttribute("id")]=t})),u(Ne,"library_controllers","controller",(function(e){for(var t={},i=0,s=e.childNodes.length;i<s;i++){var r=e.childNodes[i];if(1===r.nodeType)switch(r.nodeName){case"skin":t.id=n(r.getAttribute("source")),t.skin=L(r);break;case"morph":t.id=n(r.getAttribute("source")),console.warn("THREE.ColladaLoader: Morph target animation not supported yet.")}}Ve.controllers[e.getAttribute("id")]=t})),u(Ne,"library_images","image",(function(e){var t={init_from:i(e,"init_from")[0].textContent};Ve.images[e.getAttribute("id")]=t})),u(Ne,"library_effects","effect",(function(e){for(var t={},i=0,s=e.childNodes.length;i<s;i++){var r=e.childNodes[i];if(1===r.nodeType)switch(r.nodeName){case"profile_COMMON":t.profile=R(r)}}Ve.effects[e.getAttribute("id")]=t})),u(Ne,"library_materials","material",(function(e){for(var t={name:e.getAttribute("name")},i=0,s=e.childNodes.length;i<s;i++){var r=e.childNodes[i];if(1===r.nodeType)switch(r.nodeName){case"instance_effect":t.url=n(r.getAttribute("url"))}}Ve.materials[e.getAttribute("id")]=t})),u(Ne,"library_cameras","camera",(function(e){for(var t={name:e.getAttribute("name")},i=0,s=e.childNodes.length;i<s;i++){var r=e.childNodes[i];if(1===r.nodeType)switch(r.nodeName){case"optics":t.optics=K(r)}}Ve.cameras[e.getAttribute("id")]=t})),u(Ne,"library_lights","light",(function(e){for(var t={},i=0,s=e.childNodes.length;i<s;i++){var r=e.childNodes[i];if(1===r.nodeType)switch(r.nodeName){case"technique_common":t=J(r)}}Ve.lights[e.getAttribute("id")]=t})),u(Ne,"library_geometries","geometry",(function(e){for(var t={name:e.getAttribute("name"),sources:{},vertices:{},primitives:[]},s=i(e,"mesh")[0],r=0;r<s.childNodes.length;r++){var o=s.childNodes[r];if(1===o.nodeType){var n=o.getAttribute("id");switch(o.nodeName){case"source":t.sources[n]=ee(o);break;case"vertices":t.vertices=te(o);break;case"polygons":console.warn("THREE.ColladaLoader: Unsupported primitive type: ",o.nodeName);break;case"lines":case"linestrips":case"polylist":case"triangles":t.primitives.push(ie(o));break;default:console.log(o)}}}Ve.geometries[e.getAttribute("id")]=t})),u(Ne,"library_nodes","node",ye),u(Ne,"library_visual_scenes","visual_scene",(function(e){var t={name:e.getAttribute("name"),children:[]};!function(e){for(var t=e.getElementsByTagName("node"),i=0;i<t.length;i++){var s=t[i];!1===s.hasAttribute("id")&&s.setAttribute("id","three_default_"+De++)}}(e);for(var s=i(e,"node"),r=0;r<s.length;r++)t.children.push(ye(s[r]));Ve.visualScenes[e.getAttribute("id")]=t})),u(Ne,"library_kinematics_models","kinematics_model",(function(e){for(var t={name:e.getAttribute("name")||"",joints:{},links:[]},i=0;i<e.childNodes.length;i++){var s=e.childNodes[i];if(1===s.nodeType)switch(s.nodeName){case"technique_common":ce(s,t)}}Ve.kinematicsModels[e.getAttribute("id")]=t})),u(Ne,"scene","instance_kinematics_scene",(function(e){for(var t={bindJointAxis:[]},i=0;i<e.childNodes.length;i++){var s=e.childNodes[i];if(1===s.nodeType)switch(s.nodeName){case"bind_joint_axis":t.bindJointAxis.push(fe(s))}}Ve.kinematicsScenes[n(e.getAttribute("url"))]=t})),console.timeEnd("THREE.ColladaLoader: Parse"),console.time("THREE.ColladaLoader: Build"),p(Ve.animations,v),p(Ve.clips,A),p(Ve.controllers,O),p(Ve.images,P),p(Ve.effects,W),p(Ve.materials,q),p(Ve.cameras,Y),p(Ve.lights,(function(e){var t;switch(e.technique){case"directional":t=new h.DirectionalLight;break;case"point":t=new h.PointLight;break;case"spot":t=new h.SpotLight;break;case"ambient":t=new h.AmbientLight}return e.parameters.color&&t.color.copy(e.parameters.color),e.parameters.distance&&(t.distance=e.parameters.distance),t})),p(Ve.geometries,se),p(Ve.visualScenes,Ae),console.timeEnd("THREE.ColladaLoader: Build"),function(){var e=Ve.clips;if(!0===a(e)){if(!1===a(Ve.animations)){var t=[];for(var i in Ve.animations)for(var s=g(i),r=0,o=s.length;r<o;r++)t.push(s[r]);Re.push(new h.AnimationClip("default",-1,t))}}else for(var i in e)Re.push(C(i))}(),function(){var e=Object.keys(Ve.kinematicsModels)[0],t=Object.keys(Ve.kinematicsScenes)[0],i=Object.keys(Ve.visualScenes)[0];if(void 0!==e&&void 0!==t){for(var s,r=(s=e,d(Ve.kinematicsModels[s],ae)),o=function(e){return d(Ve.kinematicsScenes[e],me)}(t),n=Ce(i),a=o.bindJointAxis,c={},l=0,u=a.length;l<u;l++){var p=a[l],f=Ne.querySelector('[sid="'+p.target+'"]');if(f){var m=f.parentElement;g(p.jointIndex,m)}}var v=new h.Matrix4;Se={joints:r&&r.joints,getJointValue:function(e){var t=c[e];if(t)return t.position;console.warn("THREE.ColladaLoader: Joint "+e+" doesn't exist.")},setJointValue:function(e,t){var i=c[e];if(i){var s=i.joint;if(t>s.limits.max||t<s.limits.min)console.warn("THREE.ColladaLoader: Joint "+e+" value "+t+" outside of limits (min: "+s.limits.min+", max: "+s.limits.max+").");else if(s.static)console.warn("THREE.ColladaLoader: Joint "+e+" is static.");else{var r=i.object,o=s.axis,n=i.transforms;ge.identity();for(var a=0;a<n.length;a++){var l=n[a];if(l.sid&&-1!==l.sid.indexOf(e))switch(s.type){case"revolute":ge.multiply(v.makeRotationAxis(o,h.Math.degToRad(t)));break;case"prismatic":ge.multiply(v.makeTranslation(o.x*t,o.y*t,o.z*t));break;default:console.warn("THREE.ColladaLoader: Unknown joint type: "+s.type)}else switch(l.type){case"matrix":ge.multiply(l.obj);break;case"translate":ge.multiply(v.makeTranslation(l.obj.x,l.obj.y,l.obj.z));break;case"scale":ge.scale(l.obj);break;case"rotate":ge.multiply(v.makeRotationAxis(l.obj,l.angle))}}r.matrix.copy(ge),r.matrix.decompose(r.position,r.quaternion,r.scale),c[e].position=t}}else console.log("THREE.ColladaLoader: "+e+" does not exist.")}}}function g(e,t){var i=t.getAttribute("name"),s=r.joints[e];n.traverse((function(r){r.name===i&&(c[e]={object:r,transforms:ve(t),joint:s,position:s.zeroPosition})}))}}();var Fe=function(e){return Ce(n(i(e,"instance_visual_scene")[0].getAttribute("url")))}(i(Ne,"scene")[0]);return Fe.scale.multiplyScalar(Oe.unit),console.timeEnd("THREE.ColladaLoader"),{animations:Re,kinematics:Se,library:Ve,scene:Fe}}};var w={onError:function(e){console.error(e)},loaders:{dae:function(e,t,i,s){const r=i.material,o=new h.ColladaLoader(i.loader);return o.log=function(t){e.warnings&&console.warn(t)},o.load(t,(function(t){null!==r&&t.scene.traverse((function(e){e instanceof h.Mesh&&void 0===e.material&&(e.material=r)})),e.add(t.scene),s&&s()}),null,w.onError),o},obj:function(e,t,i,s){i.material;const r=new h.OBJLoader(i.loader);return r.log=function(t){e.warnings&&console.warn(t)},r.load(t,(function(o){const n=h.LoaderUtils.extractUrlBase(t);if(o.materialLibraries.length){const s=o.materialLibraries[0];new h.MTLLoader(i.loader).setPath(n).load(s,(function(i){i.preload(),function(i,s){i.setMaterials(s).load(t,(function(t){e.add(t)}),null,w.onError)}(r,i)}),null,w.onError)}else e.add(o),s&&s()}),null,w.onError),r},stl:function(e,t,i,s){const r=i.material,o=new h.STLLoader(i.loader);return o.load(t,(function(t){var i;t.computeFaceNormals(),i=null!==r?new h.Mesh(t,r):new h.Mesh(t,new h.MeshBasicMaterial({color:10066329})),e.add(i),s&&s()}),null,w.onError),o}}};class x extends h.Object3D{constructor(e,t){super();var i=(e=e||{}).path,s=e.resource;e.material,this.warnings=e.warnings,i&&"/"!==i.substr(i.length-1)&&(i+="/");var r=null,o=(r=s.startsWith("http://")||s.startsWith("https://")?s:i?i+s:s).substr(-3).toLowerCase(),n=w.loaders[o];n?n(this,r,e,t):console.warn("Unsupported loader for file type: '"+o+"'")}}class _ extends h.Object3D{constructor(e){var t=(e=e||{}).material||new h.MeshBasicMaterial,i=e.vertices,s=e.colors;super(),t.side=h.DoubleSide;const r=[];for(n=0;n<i.length;n++)r.push(new h.Vector3(i[n].x,i[n].y,i[n].z));const o=(new h.BufferGeometry).setFromPoints(r);var n,a;if(s.length===i.length){for(n=0;n<i.length;n+=3){var c=new h.Face3(n,n+1,n+2);for(a=3*n;a<3*n+3;n++){var l=new h.Color;l.setRGB(s[n].r,s[n].g,s[n].b),c.vertexColors.push(l)}o.faces.push(c)}t.vertexColors=h.VertexColors}else if(s.length===i.length/3){for(n=0;n<i.length;n+=3){var u=new h.Face3(n,n+1,n+2);u.color.setRGB(s[n/3].r,s[n/3].g,s[n/3].b),o.faces.push(u)}t.vertexColors=h.FaceColors}else for(n=0;n<i.length;n+=3){var p=new h.Face3(n,n+1,n+2);o.faces.push(p)}o.computeBoundingBox(),o.computeBoundingSphere(),o.computeFaceNormals(),this.add(new h.Mesh(o,t))}setColor(e){this.mesh.material.color.setHex(e)}}var M="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};var T={exports:{}};!function(e,t){(function(){var i=this.THREE||a.default;if(!i)throw new Error("MeshLine requires three.js");function s(){i.BufferGeometry.call(this),this.type="MeshLine",this.positions=[],this.previous=[],this.next=[],this.side=[],this.width=[],this.indices_array=[],this.uvs=[],this.counters=[],this._points=[],this._geom=null,this.widthCallback=null,this.matrixWorld=new i.Matrix4,Object.defineProperties(this,{geometry:{enumerable:!0,get:function(){return this}},geom:{enumerable:!0,get:function(){return this._geom},set:function(e){this.setGeometry(e,this.widthCallback)}},points:{enumerable:!0,get:function(){return this._points},set:function(e){this.setPoints(e,this.widthCallback)}}})}function r(e,t){var s=new i.Matrix4,r=new i.Ray,o=new i.Sphere,n=new i.Vector3,a=this.geometry;if(o.copy(a.boundingSphere),o.applyMatrix4(this.matrixWorld),!1!==e.ray.intersectSphere(o,n)){s.getInverse(this.matrixWorld),r.copy(e.ray).applyMatrix4(s);var c=new i.Vector3,h=new i.Vector3,l=new i.Vector3,u=this instanceof i.LineSegments?2:1,p=a.index,d=a.attributes;if(null!==p)for(var f=p.array,m=d.position.array,v=d.width.array,g=0,b=f.length-1;g<b;g+=u){var y=f[g],w=f[g+1];c.fromArray(m,3*y),h.fromArray(m,3*w);var x=null!=v[Math.floor(g/3)]?v[Math.floor(g/3)]:1,_=e.params.Line.threshold+this.material.lineWidth*x/2,M=_*_;if(!(r.distanceSqToSegment(c,h,n,l)>M)){n.applyMatrix4(this.matrixWorld);var T=e.ray.origin.distanceTo(n);T<e.near||T>e.far||(t.push({distance:T,point:l.clone().applyMatrix4(this.matrixWorld),index:g,face:null,faceIndex:null,object:this}),g=b)}}}}function o(e,t,i,s,r){var o;if(e=e.subarray||e.slice?e:e.buffer,i=i.subarray||i.slice?i:i.buffer,e=t?e.subarray?e.subarray(t,r&&t+r):e.slice(t,r&&t+r):e,i.set)i.set(e,s);else for(o=0;o<e.length;o++)i[o+s]=e[o];return i}function n(e){i.ShaderMaterial.call(this,{uniforms:Object.assign({},i.UniformsLib.fog,{lineWidth:{value:1},map:{value:null},useMap:{value:0},alphaMap:{value:null},useAlphaMap:{value:0},color:{value:new i.Color(16777215)},opacity:{value:1},resolution:{value:new i.Vector2(1,1)},sizeAttenuation:{value:1},dashArray:{value:0},dashOffset:{value:0},dashRatio:{value:.5},useDash:{value:0},visibility:{value:1},alphaTest:{value:0},repeat:{value:new i.Vector2(1,1)}}),vertexShader:i.ShaderChunk.meshline_vert,fragmentShader:i.ShaderChunk.meshline_frag}),this.type="MeshLineMaterial",Object.defineProperties(this,{lineWidth:{enumerable:!0,get:function(){return this.uniforms.lineWidth.value},set:function(e){this.uniforms.lineWidth.value=e}},map:{enumerable:!0,get:function(){return this.uniforms.map.value},set:function(e){this.uniforms.map.value=e}},useMap:{enumerable:!0,get:function(){return this.uniforms.useMap.value},set:function(e){this.uniforms.useMap.value=e}},alphaMap:{enumerable:!0,get:function(){return this.uniforms.alphaMap.value},set:function(e){this.uniforms.alphaMap.value=e}},useAlphaMap:{enumerable:!0,get:function(){return this.uniforms.useAlphaMap.value},set:function(e){this.uniforms.useAlphaMap.value=e}},color:{enumerable:!0,get:function(){return this.uniforms.color.value},set:function(e){this.uniforms.color.value=e}},opacity:{enumerable:!0,get:function(){return this.uniforms.opacity.value},set:function(e){this.uniforms.opacity.value=e}},resolution:{enumerable:!0,get:function(){return this.uniforms.resolution.value},set:function(e){this.uniforms.resolution.value.copy(e)}},sizeAttenuation:{enumerable:!0,get:function(){return this.uniforms.sizeAttenuation.value},set:function(e){this.uniforms.sizeAttenuation.value=e}},dashArray:{enumerable:!0,get:function(){return this.uniforms.dashArray.value},set:function(e){this.uniforms.dashArray.value=e,this.useDash=0!==e?1:0}},dashOffset:{enumerable:!0,get:function(){return this.uniforms.dashOffset.value},set:function(e){this.uniforms.dashOffset.value=e}},dashRatio:{enumerable:!0,get:function(){return this.uniforms.dashRatio.value},set:function(e){this.uniforms.dashRatio.value=e}},useDash:{enumerable:!0,get:function(){return this.uniforms.useDash.value},set:function(e){this.uniforms.useDash.value=e}},visibility:{enumerable:!0,get:function(){return this.uniforms.visibility.value},set:function(e){this.uniforms.visibility.value=e}},alphaTest:{enumerable:!0,get:function(){return this.uniforms.alphaTest.value},set:function(e){this.uniforms.alphaTest.value=e}},repeat:{enumerable:!0,get:function(){return this.uniforms.repeat.value},set:function(e){this.uniforms.repeat.value.copy(e)}}}),this.setValues(e)}s.prototype=Object.create(i.BufferGeometry.prototype),s.prototype.constructor=s,s.prototype.isMeshLine=!0,s.prototype.setMatrixWorld=function(e){this.matrixWorld=e},s.prototype.setGeometry=function(e,t){this._geometry=e,e instanceof i.Geometry?this.setPoints(e.vertices,t):e instanceof i.BufferGeometry?this.setPoints(e.getAttribute("position").array,t):this.setPoints(e,t)},s.prototype.setPoints=function(e,t){if(e instanceof Float32Array||e instanceof Array){if(this._points=e,this.widthCallback=t,this.positions=[],this.counters=[],e.length&&e[0]instanceof i.Vector3)for(var s=0;s<e.length;s++){var r=e[s],o=s/e.length;this.positions.push(r.x,r.y,r.z),this.positions.push(r.x,r.y,r.z),this.counters.push(o),this.counters.push(o)}else for(s=0;s<e.length;s+=3){o=s/e.length;this.positions.push(e[s],e[s+1],e[s+2]),this.positions.push(e[s],e[s+1],e[s+2]),this.counters.push(o),this.counters.push(o)}this.process()}else console.error("ERROR: The BufferArray of points is not instancied correctly.")},s.prototype.raycast=r,s.prototype.compareV3=function(e,t){var i=6*e,s=6*t;return this.positions[i]===this.positions[s]&&this.positions[i+1]===this.positions[s+1]&&this.positions[i+2]===this.positions[s+2]},s.prototype.copyV3=function(e){var t=6*e;return[this.positions[t],this.positions[t+1],this.positions[t+2]]},s.prototype.process=function(){var e,t,s=this.positions.length/6;this.previous=[],this.next=[],this.side=[],this.width=[],this.indices_array=[],this.uvs=[],t=this.compareV3(0,s-1)?this.copyV3(s-2):this.copyV3(0),this.previous.push(t[0],t[1],t[2]),this.previous.push(t[0],t[1],t[2]);for(var r=0;r<s;r++){if(this.side.push(1),this.side.push(-1),e=this.widthCallback?this.widthCallback(r/(s-1)):1,this.width.push(e),this.width.push(e),this.uvs.push(r/(s-1),0),this.uvs.push(r/(s-1),1),r<s-1){t=this.copyV3(r),this.previous.push(t[0],t[1],t[2]),this.previous.push(t[0],t[1],t[2]);var o=2*r;this.indices_array.push(o,o+1,o+2),this.indices_array.push(o+2,o+1,o+3)}r>0&&(t=this.copyV3(r),this.next.push(t[0],t[1],t[2]),this.next.push(t[0],t[1],t[2]))}t=this.compareV3(s-1,0)?this.copyV3(1):this.copyV3(s-1),this.next.push(t[0],t[1],t[2]),this.next.push(t[0],t[1],t[2]),this._attributes&&this._attributes.position.count===this.positions.length?(this._attributes.position.copyArray(new Float32Array(this.positions)),this._attributes.position.needsUpdate=!0,this._attributes.previous.copyArray(new Float32Array(this.previous)),this._attributes.previous.needsUpdate=!0,this._attributes.next.copyArray(new Float32Array(this.next)),this._attributes.next.needsUpdate=!0,this._attributes.side.copyArray(new Float32Array(this.side)),this._attributes.side.needsUpdate=!0,this._attributes.width.copyArray(new Float32Array(this.width)),this._attributes.width.needsUpdate=!0,this._attributes.uv.copyArray(new Float32Array(this.uvs)),this._attributes.uv.needsUpdate=!0,this._attributes.index.copyArray(new Uint16Array(this.indices_array)),this._attributes.index.needsUpdate=!0):this._attributes={position:new i.BufferAttribute(new Float32Array(this.positions),3),previous:new i.BufferAttribute(new Float32Array(this.previous),3),next:new i.BufferAttribute(new Float32Array(this.next),3),side:new i.BufferAttribute(new Float32Array(this.side),1),width:new i.BufferAttribute(new Float32Array(this.width),1),uv:new i.BufferAttribute(new Float32Array(this.uvs),2),index:new i.BufferAttribute(new Uint16Array(this.indices_array),1),counters:new i.BufferAttribute(new Float32Array(this.counters),1)},this.setAttribute("position",this._attributes.position),this.setAttribute("previous",this._attributes.previous),this.setAttribute("next",this._attributes.next),this.setAttribute("side",this._attributes.side),this.setAttribute("width",this._attributes.width),this.setAttribute("uv",this._attributes.uv),this.setAttribute("counters",this._attributes.counters),this.setIndex(this._attributes.index),this.computeBoundingSphere(),this.computeBoundingBox()},s.prototype.advance=function(e){var t=this._attributes.position.array,i=this._attributes.previous.array,s=this._attributes.next.array,r=t.length;o(t,0,i,0,r),o(t,6,t,0,r-6),t[r-6]=e.x,t[r-5]=e.y,t[r-4]=e.z,t[r-3]=e.x,t[r-2]=e.y,t[r-1]=e.z,o(t,6,s,0,r-6),s[r-6]=e.x,s[r-5]=e.y,s[r-4]=e.z,s[r-3]=e.x,s[r-2]=e.y,s[r-1]=e.z,this._attributes.position.needsUpdate=!0,this._attributes.previous.needsUpdate=!0,this._attributes.next.needsUpdate=!0},i.ShaderChunk.meshline_vert=["",i.ShaderChunk.logdepthbuf_pars_vertex,i.ShaderChunk.fog_pars_vertex,"","attribute vec3 previous;","attribute vec3 next;","attribute float side;","attribute float width;","attribute float counters;","","uniform vec2 resolution;","uniform float lineWidth;","uniform vec3 color;","uniform float opacity;","uniform float sizeAttenuation;","","varying vec2 vUV;","varying vec4 vColor;","varying float vCounters;","","vec2 fix( vec4 i, float aspect ) {","","    vec2 res = i.xy / i.w;","    res.x *= aspect;","\t vCounters = counters;","    return res;","","}","","void main() {","","    float aspect = resolution.x / resolution.y;","","    vColor = vec4( color, opacity );","    vUV = uv;","","    mat4 m = projectionMatrix * modelViewMatrix;","    vec4 finalPosition = m * vec4( position, 1.0 );","    vec4 prevPos = m * vec4( previous, 1.0 );","    vec4 nextPos = m * vec4( next, 1.0 );","","    vec2 currentP = fix( finalPosition, aspect );","    vec2 prevP = fix( prevPos, aspect );","    vec2 nextP = fix( nextPos, aspect );","","    float w = lineWidth * width;","","    vec2 dir;","    if( nextP == currentP ) dir = normalize( currentP - prevP );","    else if( prevP == currentP ) dir = normalize( nextP - currentP );","    else {","        vec2 dir1 = normalize( currentP - prevP );","        vec2 dir2 = normalize( nextP - currentP );","        dir = normalize( dir1 + dir2 );","","        vec2 perp = vec2( -dir1.y, dir1.x );","        vec2 miter = vec2( -dir.y, dir.x );","        //w = clamp( w / dot( miter, perp ), 0., 4. * lineWidth * width );","","    }","","    //vec2 normal = ( cross( vec3( dir, 0. ), vec3( 0., 0., 1. ) ) ).xy;","    vec4 normal = vec4( -dir.y, dir.x, 0., 1. );","    normal.xy *= .5 * w;","    normal *= projectionMatrix;","    if( sizeAttenuation == 0. ) {","        normal.xy *= finalPosition.w;","        normal.xy /= ( vec4( resolution, 0., 1. ) * projectionMatrix ).xy;","    }","","    finalPosition.xy += normal.xy * side;","","    gl_Position = finalPosition;","",i.ShaderChunk.logdepthbuf_vertex,i.ShaderChunk.fog_vertex&&"    vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );",i.ShaderChunk.fog_vertex,"}"].join("\n"),i.ShaderChunk.meshline_frag=["",i.ShaderChunk.fog_pars_fragment,i.ShaderChunk.logdepthbuf_pars_fragment,"","uniform sampler2D map;","uniform sampler2D alphaMap;","uniform float useMap;","uniform float useAlphaMap;","uniform float useDash;","uniform float dashArray;","uniform float dashOffset;","uniform float dashRatio;","uniform float visibility;","uniform float alphaTest;","uniform vec2 repeat;","","varying vec2 vUV;","varying vec4 vColor;","varying float vCounters;","","void main() {","",i.ShaderChunk.logdepthbuf_fragment,"","    vec4 c = vColor;","    if( useMap == 1. ) c *= texture2D( map, vUV * repeat );","    if( useAlphaMap == 1. ) c.a *= texture2D( alphaMap, vUV * repeat ).a;","    if( c.a < alphaTest ) discard;","    if( useDash == 1. ){","        c.a *= ceil(mod(vCounters + dashOffset, dashArray) - (dashArray * dashRatio));","    }","    gl_FragColor = c;","    gl_FragColor.a *= step(vCounters, visibility);","",i.ShaderChunk.fog_fragment,"}"].join("\n"),n.prototype=Object.create(i.ShaderMaterial.prototype),n.prototype.constructor=n,n.prototype.isMeshLineMaterial=!0,n.prototype.copy=function(e){return i.ShaderMaterial.prototype.copy.call(this,e),this.lineWidth=e.lineWidth,this.map=e.map,this.useMap=e.useMap,this.alphaMap=e.alphaMap,this.useAlphaMap=e.useAlphaMap,this.color.copy(e.color),this.opacity=e.opacity,this.resolution.copy(e.resolution),this.sizeAttenuation=e.sizeAttenuation,this.dashArray.copy(e.dashArray),this.dashOffset.copy(e.dashOffset),this.dashRatio.copy(e.dashRatio),this.useDash=e.useDash,this.visibility=e.visibility,this.alphaTest=e.alphaTest,this.repeat.copy(e.repeat),this},e.exports&&(t=e.exports={MeshLine:s,MeshLineMaterial:n,MeshLineRaycast:r}),t.MeshLine=s,t.MeshLineMaterial=n,t.MeshLineRaycast=r}).call(M)}(T,T.exports);class k extends h.Object3D{constructor(e){super();var t=(e=e||{}).path,i=e.message;t&&"/"!==t.substr(t.length-1)&&(t+="/"),i.scale?this.msgScale=[i.scale.x,i.scale.y,i.scale.z]:this.msgScale=[1,1,1],this.msgColor=i.color,this.msgMesh=void 0,this.setPose(i.pose);var s=l(this.msgColor.r,this.msgColor.g,this.msgColor.b,this.msgColor.a);switch(i.type){case 0:var r,o=i.scale.x,n=.23*o,a=i.scale.y,c=.5*a,u=null;if(2===i.points.length){u=new h.Vector3(i.points[0].x,i.points[0].y,i.points[0].z);var p=new h.Vector3(i.points[1].x,i.points[1].y,i.points[1].z);o=(r=u.clone().negate().add(p)).length(),a=i.scale.y,c=i.scale.x,0!==i.scale.z&&(n=i.scale.z)}this.add(new m({direction:r,origin:u,length:o,headLength:n,shaftDiameter:c,headDiameter:a,material:s}));break;case 1:var d=new h.BoxGeometry(i.scale.x,i.scale.y,i.scale.z);this.add(new h.Mesh(d,s));break;case 2:var f=new h.SphereGeometry(.5),v=new h.Mesh(f,s);v.scale.x=i.scale.x,v.scale.y=i.scale.y,v.scale.z=i.scale.z,this.add(v);break;case 3:var g=new h.CylinderGeometry(.5,.5,1,16,1,!1),b=new h.Mesh(g,s);b.quaternion.setFromAxisAngle(new h.Vector3(1,0,0),.5*Math.PI),b.scale.set(i.scale.x,i.scale.z,i.scale.y),this.add(b);break;case 4:const e=new T.exports.MeshLineMaterial({lineWidth:Math.max(1,i.scale.x),sizeAttenuation:!0}),$=[];let ee;for(ee=0;ee<i.points.length;ee++)$.push(new h.Vector3(i.points[ee].x,i.points[ee].y,i.points[ee].z));const te=new T.exports.MeshLine;if(i.colors.length===i.points.length){const t=[];for(e.vertexColors=!0,ee=0;ee<i.points.length;ee++){const e=new h.Color;e.setRGB(i.colors[ee].r,i.colors[ee].g,i.colors[ee].b),t.push(e)}te.setPoints($,t)}else{const t=new h.Color;t.setRGB(i.color.r,i.color.g,i.color.b),te.setPoints($),e.color=t}const ie=new h.Mesh(te,e);this.add(ie);break;case 5:const se=new T.exports.MeshLineMaterial({lineWidth:Math.max(1,i.scale.x),sizeAttenuation:!0}),re=new T.exports.MeshLine,oe=[];let ne;for(ne=0;ne<i.points.length;ne++)oe.push(new h.Vector3(i.points[ne].x,i.points[ne].y,i.points[ne].z));if(i.colors.length===i.points.length){const e=[];for(ne=0;ne<i.points.length;ne++){const t=new h.Color;t.setRGB(i.colors[ne].r,i.colors[ne].g,i.colors[ne].b),e.push(t)}re.setPoints(oe,e)}else{const e=new h.Color;e.setRGB(i.color.r,i.color.g,i.color.b),se.color=e,re.setPoints(oe)}const ae=new h.Mesh(re,se);this.add(ae);break;case 6:var y,w,M,k,E=new h.Object3D,A=i.points.length,C=A===i.colors.length,L=Math.ceil(A/1250);for(y=0;y<A;y+=L)w=new h.BoxGeometry(i.scale.x,i.scale.y,i.scale.z),M=C?l(i.colors[y].r,i.colors[y].g,i.colors[y].b,i.colors[y].a):s,(k=new h.Mesh(w,M)).position.x=i.points[y].x,k.position.y=i.points[y].y,k.position.z=i.points[y].z,E.add(k);this.add(E);break;case 7:var N,j,O,P,R=new h.Object3D,S=i.points.length,D=S===i.colors.length,V=Math.ceil(S/1250);for(N=0;N<S;N+=V)j=new h.SphereGeometry(.5,8,8),O=D?l(i.colors[N].r,i.colors[N].g,i.colors[N].b,i.colors[N].a):s,(P=new h.Mesh(j,O)).scale.x=i.scale.x,P.scale.y=i.scale.y,P.scale.z=i.scale.z,P.position.x=i.points[N].x,P.position.y=i.points[N].y,P.position.z=i.points[N].z,R.add(P);this.add(R);break;case 8:var F=new h.ParticleBasicMaterial({size:i.scale.x});const ce=[];var I;for(I=0;I<i.points.length;I++)ce.push(new h.Vector3(i.points[I].x,i.points[I].y,i.points[I].z));const he=(new h.BufferGeometry).setFromPoints(ce);if(i.colors.length===i.points.length)for(F.vertexColors=!0,I=0;I<i.points.length;I++){var z=new h.Color;z.setRGB(i.colors[I].r,i.colors[I].g,i.colors[I].b),he.colors.push(z)}else F.color.setRGB(i.color.r,i.color.g,i.color.b);this.add(new h.ParticleSystem(he,F));break;case 9:if(i.text.length>0){var U=this.msgColor,B=document.createElement("canvas"),G=B.getContext("2d"),W="normal 100px sans-serif";G.font=W;var q=G.measureText(i.text).width;B.width=q,B.height=150,G.font=W,G.fillStyle="rgba("+Math.round(255*U.r)+", "+Math.round(255*U.g)+", "+Math.round(255*U.b)+", "+U.a+")",G.textAlign="left",G.textBaseline="middle",G.fillText(i.text,0,B.height/2);var H=new h.Texture(B);H.needsUpdate=!0;var K=new h.SpriteMaterial({map:H,useScreenCoordinates:!1}),Q=new h.Sprite(K),X=i.scale.x;Q.scale.set(q/B.height*X,X,1),this.add(Q)}break;case 10:var Y=null;0===i.color.r&&0===i.color.g&&0===i.color.b&&0===i.color.a||(Y=s),t&&"package://"===i.mesh_resource.substr(0,10)?this.msgMesh=i.mesh_resource.substr(10):(this.msgMesh=i.mesh_resource,t=null);var Z=new x({path:t,resource:this.msgMesh,material:Y});Z.scale.set(i.scale.x,i.scale.y,i.scale.z),this.add(Z);break;case 11:var J=new _({material:s,vertices:i.points,colors:i.colors});J.scale.set(i.scale.x,i.scale.y,i.scale.z),this.add(J);break;default:console.error("Currently unsupported marker type: "+i.type)}}setPose(e){this.position.x=e.position.x,this.position.y=e.position.y,this.position.z=e.position.z,this.quaternion.set(e.orientation.x,e.orientation.y,e.orientation.z,e.orientation.w),this.quaternion.normalize(),this.updateMatrixWorld()}update(e){if(this.setPose(e.pose),e.color.r!==this.msgColor.r||e.color.g!==this.msgColor.g||e.color.b!==this.msgColor.b||e.color.a!==this.msgColor.a){var t=l(e.color.r,e.color.g,e.color.b,e.color.a);switch(e.type){case 4:case 5:case 8:break;case 0:case 1:case 2:case 3:case 11:case 9:this.traverse((function(e){e instanceof h.Mesh&&(e.material=t)}));break;case 10:var i=null;0===e.color.r&&0===e.color.g&&0===e.color.b&&0===e.color.a||(i=this.colorMaterial),this.traverse((function(e){e instanceof h.Mesh&&(e.material=i)}));break;case 6:case 7:default:return!1}this.msgColor=e.color}var s=Math.abs(this.msgScale[0]-e.scale.x)>1e-6||Math.abs(this.msgScale[1]-e.scale.y)>1e-6||Math.abs(this.msgScale[2]-e.scale.z)>1e-6;switch(this.msgScale=[e.scale.x,e.scale.y,e.scale.z],e.type){case 1:case 2:case 3:if(s)return!1;break;case 9:if(s||this.text!==e.text)return!1;break;case 10:if(e.mesh_resource.substr(10)!==this.msgMesh)return!1;if(s)return!1;break;case 0:case 4:case 5:case 6:case 7:case 8:case 11:return!1}return!0}dispose(){this.children.forEach((function(e){e instanceof x?e.children.forEach((function(t){void 0!==t.material&&t.material.dispose(),t.children.forEach((function(e){void 0!==e.geometry&&e.geometry.dispose(),void 0!==e.material&&e.material.dispose(),t.remove(e)})),e.remove(t)})):(void 0!==e.geometry&&e.geometry.dispose(),void 0!==e.material&&e.material.dispose()),e.parent.remove(e)}))}}class E extends h.Object3D{constructor(e){super();var t=this;e=e||{},this.parent=e.parent;var i=e.handle,s=e.message;this.message=s,this.name=s.name,this.camera=e.camera,this.path=e.path||"/",this.loader=e.loader,this.dragging=!1,this.startMousePos=new h.Vector2,this.isShift=!1;var r=new h.Quaternion(s.orientation.x,s.orientation.y,s.orientation.z,s.orientation.w);r.normalize();var o=new h.Vector3(1,0,0);switch(o.applyQuaternion(r),this.currentControlOri=new h.Quaternion,s.interaction_mode){case 9:case 7:this.addEventListener("mousemove",this.parent.move3d.bind(this.parent,this,o));break;case 3:this.addEventListener("mousemove",this.parent.moveAxis.bind(this.parent,this,o)),this.addEventListener("touchmove",this.parent.moveAxis.bind(this.parent,this,o));break;case 5:this.addEventListener("mousemove",this.parent.rotateAxis.bind(this.parent,this,r));break;case 4:this.addEventListener("mousemove",this.parent.movePlane.bind(this.parent,this,o));break;case 2:this.addEventListener("click",this.parent.buttonClick.bind(this.parent,this))}function n(e){e.stopPropagation()}0!==s.interaction_mode&&(this.addEventListener("mousedown",this.parent.startDrag.bind(this.parent,this)),this.addEventListener("mouseup",this.parent.stopDrag.bind(this.parent,this)),this.addEventListener("contextmenu",this.parent.showMenu.bind(this.parent,this)),this.addEventListener("mouseup",(function(e){0===t.startMousePos.distanceToSquared(e.mousePos)&&(e.type="contextmenu",t.dispatchEvent(e))})),this.addEventListener("mouseover",n),this.addEventListener("mouseout",n),this.addEventListener("click",n),this.addEventListener("mousedown",(function(e){t.startMousePos=e.mousePos})),this.addEventListener("touchstart",(function(e){1===e.domEvent.touches.length&&(e.type="mousedown",e.domEvent.button=0,t.dispatchEvent(e))})),this.addEventListener("touchmove",(function(e){1===e.domEvent.touches.length&&(e.type="mousemove",e.domEvent.button=0,t.dispatchEvent(e))})),this.addEventListener("touchend",(function(e){0===e.domEvent.touches.length&&(e.domEvent.button=0,e.type="mouseup",t.dispatchEvent(e),e.type="click",t.dispatchEvent(e))})),window.addEventListener("keydown",(function(e){16===e.keyCode&&(t.isShift=!0)})),window.addEventListener("keyup",(function(e){16===e.keyCode&&(t.isShift=!1)})));var a=new h.Quaternion,l=this.parent.position.clone().multiplyScalar(-1);switch(s.orientation_mode){case 0:a=this.parent.quaternion.clone().inverse();break;case 1:case 2:break;default:console.error("Unkown orientation mode: "+s.orientation_mode)}var u=new c.TFClient({ros:i.tfClient.ros,fixedFrame:i.message.header.frame_id,serverName:i.tfClient.serverName});s.markers.forEach((function(e){var i=function(i){var s=new k({message:e,path:t.path,loader:t.loader});if(null!==i){var r=new c.Pose({position:s.position,orientation:s.quaternion});r.applyTransform(new c.Transform(i));var o=new k({message:e,path:t.path,loader:t.loader});o.position.add(l),o.position.applyQuaternion(a),o.quaternion.multiplyQuaternions(a,o.quaternion);var n=new h.Vector3(o.position.x,o.position.y,o.position.z),p=new c.Transform({translation:n,orientation:o.quaternion});r.applyTransform(p),s.setPose(r),s.updateMatrixWorld(),u.unsubscribe(e.header.frame_id)}t.add(s)};""!==e.header.frame_id?u.subscribe(e.header.frame_id,i):i(null)}))}updateMatrixWorld(e){var t=this,i=this.message;switch(i.orientation_mode){case 0:super.updateMatrixWorld(e),t.currentControlOri.copy(t.quaternion),t.currentControlOri.normalize();break;case 1:t.quaternion.copy(t.parent.quaternion.clone().inverse()),t.updateMatrix(),t.matrixWorldNeedsUpdate=!0,super.updateMatrixWorld(e),t.currentControlOri.copy(t.quaternion);break;case 2:t.camera.updateMatrixWorld();var s=(new h.Matrix4).extractRotation(t.camera.matrixWorld),r=new h.Matrix4,o=.5*Math.PI,n=new h.Euler(-o,0,o);r.makeRotationFromEuler(n);var a=new h.Matrix4;a.getInverse(t.parent.matrixWorld),s.multiplyMatrices(s,r),s.multiplyMatrices(a,s),t.currentControlOri.setFromRotationMatrix(s),i.independent_marker_orientation||(t.quaternion.copy(t.currentControlOri),t.updateMatrix(),t.matrixWorldNeedsUpdate=!0),super.updateMatrixWorld(e);break;default:console.error("Unkown orientation mode: "+i.orientation_mode)}}}class A extends h.EventDispatcher{constructor(e){super();var t=this,i=(e=e||{}).menuEntries,s=e.className||"default-interactive-marker-menu";e.entryClassName;var r,o,n,a=e.overlayClassName||"default-interactive-marker-overlay",c=e.menuFontSize||"0.8em",h=[];if(h[0]={children:[]},null===document.getElementById("default-interactive-marker-menu-css")){var l=document.createElement("style");l.id="default-interactive-marker-menu-css",l.type="text/css",l.innerHTML=".default-interactive-marker-menu {background-color: #444444;border: 1px solid #888888;border: 1px solid #888888;padding: 0px 0px 0px 0px;color: #FFFFFF;font-family: sans-serif;font-size: "+c+";z-index: 1002;}.default-interactive-marker-menu ul {padding: 0px 0px 5px 0px;margin: 0px;list-style-type: none;}.default-interactive-marker-menu ul li div {-webkit-touch-callout: none;-webkit-user-select: none;-khtml-user-select: none;-moz-user-select: none;-ms-user-select: none;user-select: none;cursor: default;padding: 3px 10px 3px 10px;}.default-interactive-marker-menu-entry:hover {  background-color: #666666;  cursor: pointer;}.default-interactive-marker-menu ul ul {  font-style: italic;  padding-left: 10px;}.default-interactive-marker-overlay {  position: absolute;  top: 0%;  left: 0%;  width: 100%;  height: 100%;  background-color: black;  z-index: 1001;  -moz-opacity: 0.0;  opacity: .0;  filter: alpha(opacity = 0);}",document.getElementsByTagName("head")[0].appendChild(l)}for(this.menuDomElem=document.createElement("div"),this.menuDomElem.style.position="absolute",this.menuDomElem.className=s,this.menuDomElem.addEventListener("contextmenu",(function(e){e.preventDefault()})),this.overlayDomElem=document.createElement("div"),this.overlayDomElem.className=a,this.hideListener=this.hide.bind(this),this.overlayDomElem.addEventListener("contextmenu",this.hideListener),this.overlayDomElem.addEventListener("click",this.hideListener),this.overlayDomElem.addEventListener("touchstart",this.hideListener),r=0;r<i.length;r++)h[n=(o=i[r]).id]={title:o.title,id:n,children:[]};for(r=0;r<i.length;r++){var u=h[n=(o=i[r]).id];h[o.parent_id].children.push(u)}function p(e,t){this.dispatchEvent({type:"menu-select",domEvent:t,id:e.id,controlName:this.controlName}),this.hide(t)}!function e(i,s){var r=document.createElement("ul");i.appendChild(r);for(var o=s.children,n=0;n<o.length;n++){var a=document.createElement("li"),c=document.createElement("div");c.appendChild(document.createTextNode(o[n].title)),r.appendChild(a),a.appendChild(c),o[n].children.length>0?(e(a,o[n]),c.addEventListener("click",t.hide.bind(t)),c.addEventListener("touchstart",t.hide.bind(t))):(c.addEventListener("click",p.bind(t,o[n])),c.addEventListener("touchstart",p.bind(t,o[n])),c.className="default-interactive-marker-menu-entry")}}(this.menuDomElem,h[0])}show(e,t){t&&t.preventDefault&&t.preventDefault(),this.controlName=e.name,void 0!==t.domEvent.changedTouches?(this.menuDomElem.style.left=t.domEvent.changedTouches[0].pageX+"px",this.menuDomElem.style.top=t.domEvent.changedTouches[0].pageY+"px"):(this.menuDomElem.style.left=t.domEvent.clientX+"px",this.menuDomElem.style.top=t.domEvent.clientY+"px"),document.body.appendChild(this.overlayDomElem),document.body.appendChild(this.menuDomElem)}hide(e){e&&e.preventDefault&&e.preventDefault(),document.body.removeChild(this.overlayDomElem),document.body.removeChild(this.menuDomElem)}}class C extends h.Object3D{constructor(e){super();var t=this,i=(e=e||{}).handle;this.name=i.name;var s=e.camera,r=e.path||"/",o=e.loader;this.dragging=!1,this.onServerSetPose({pose:i.pose}),this.dragStart={position:new h.Vector3,orientation:new h.Quaternion,positionWorld:new h.Vector3,orientationWorld:new h.Quaternion,event3d:{}},i.controls.forEach((function(e){t.add(new E({parent:t,handle:i,message:e,camera:s,path:r,loader:o}))})),i.menuEntries.length>0&&(this.menu=new A({menuEntries:i.menuEntries,menuFontSize:i.menuFontSize}),this.menu.addEventListener("menu-select",(function(e){t.dispatchEvent(e)})))}showMenu(e,t){this.menu&&this.menu.show(e,t)}moveAxis(e,t,i){if(this.dragging){var s=e.currentControlOri,r=t.clone().applyQuaternion(s),o=this.dragStart.event3d.intersection.point,n=r.clone().applyQuaternion(this.dragStart.orientationWorld.clone()),a=new h.Ray(o,n),c=d(a,i.camera,i.mousePos),l=new h.Vector3;l.addVectors(this.dragStart.position,r.clone().applyQuaternion(this.dragStart.orientation).multiplyScalar(c)),this.setPosition(e,l),i.stopPropagation()}}move3d(e,t,i){if(this.dragging)if(e.isShift);else{var s=e.camera.getWorldDirection(),r=Math.abs(s.x),o=Math.abs(s.y),n=Math.abs(s.z),a=new h.Quaternion(1,0,0,1);o>r&&o>n?a=new h.Quaternion(0,0,1,1):n>r&&n>o&&(a=new h.Quaternion(0,1,0,1)),a.normalize(),(t=new h.Vector3(1,0,0)).applyQuaternion(a),this.movePlane(e,t,i)}}movePlane(e,t,i){if(this.dragging){var s=e.currentControlOri,r=t.clone().applyQuaternion(s),o=this.dragStart.event3d.intersection.point,n=r.clone().applyQuaternion(this.dragStart.orientationWorld),a=u(i.mouseRay,o,n),c=new h.Vector3;c.subVectors(a,o),c.add(this.dragStart.positionWorld),this.setPosition(e,c),i.stopPropagation()}}rotateAxis(e,t,i){if(this.dragging){e.updateMatrixWorld();var s=e.currentControlOri.clone().multiply(t.clone()),r=new h.Vector3(1,0,0).applyQuaternion(s),o=this.dragStart.event3d.intersection.point,n=r.applyQuaternion(this.dragStart.orientationWorld),a=u(i.mouseRay,o,n),c=new h.Ray(this.dragStart.positionWorld,n),l=u(c,o,n),p=this.dragStart.orientationWorld.clone().multiply(s).clone().inverse();a.sub(l),a.applyQuaternion(p);var d=this.dragStart.event3d.intersection.point.clone();d.sub(l),d.applyQuaternion(p);var f=Math.atan2(a.y,a.z),m=Math.atan2(d.y,d.z)-f,v=new h.Quaternion;v.setFromAxisAngle(r,m),this.setOrientation(e,v.multiply(this.dragStart.orientationWorld)),i.stopPropagation()}}feedbackEvent(e,t){this.dispatchEvent({type:e,position:this.position.clone(),orientation:this.quaternion.clone(),controlName:t.name})}startDrag(e,t){if(0===t.domEvent.button){t.stopPropagation(),this.dragging=!0,this.updateMatrixWorld(!0);var i=new h.Vector3;this.matrixWorld.decompose(this.dragStart.positionWorld,this.dragStart.orientationWorld,i),this.dragStart.position=this.position.clone(),this.dragStart.orientation=this.quaternion.clone(),this.dragStart.event3d=t,this.feedbackEvent("user-mousedown",e)}}stopDrag(e,t){0===t.domEvent.button&&(t.stopPropagation(),this.dragging=!1,this.dragStart.event3d={},this.onServerSetPose(this.bufferedPoseEvent),this.bufferedPoseEvent=void 0,this.feedbackEvent("user-mouseup",e))}buttonClick(e,t){t.stopPropagation(),this.feedbackEvent("user-button-click",e)}setPosition(e,t){this.position.copy(t),this.feedbackEvent("user-pose-change",e)}setOrientation(e,t){t.normalize(),this.quaternion.copy(t),this.feedbackEvent("user-pose-change",e)}onServerSetPose(e){if(void 0!==e)if(this.dragging)this.bufferedPoseEvent=e;else{var t=e.pose;this.position.copy(t.position),this.quaternion.copy(t.orientation),this.updateMatrixWorld(!0)}}dispose(){var e=this;this.children.forEach((function(t){t.children.forEach((function(e){e.dispose(),t.remove(e)})),e.remove(t)}))}}var L,N={exports:{}};
/*!
   * EventEmitter2
   * https://github.com/hij1nx/EventEmitter2
   *
   * Copyright (c) 2013 hij1nx
   * Licensed under the MIT license.
   */L=N,function(e){var t=Object.hasOwnProperty,i=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)},s="object"==typeof process&&"function"==typeof process.nextTick,r="function"==typeof Symbol,o="object"==typeof Reflect,n="function"==typeof setImmediate?setImmediate:setTimeout,a=r?o&&"function"==typeof Reflect.ownKeys?Reflect.ownKeys:function(e){var t=Object.getOwnPropertyNames(e);return t.push.apply(t,Object.getOwnPropertySymbols(e)),t}:Object.keys;function c(){this._events={},this._conf&&h.call(this,this._conf)}function h(t){t&&(this._conf=t,t.delimiter&&(this.delimiter=t.delimiter),t.maxListeners!==e&&(this._maxListeners=t.maxListeners),t.wildcard&&(this.wildcard=t.wildcard),t.newListener&&(this._newListener=t.newListener),t.removeListener&&(this._removeListener=t.removeListener),t.verboseMemoryLeak&&(this.verboseMemoryLeak=t.verboseMemoryLeak),t.ignoreErrors&&(this.ignoreErrors=t.ignoreErrors),this.wildcard&&(this.listenerTree={}))}function l(e,t){var i="(node) warning: possible EventEmitter memory leak detected. "+e+" listeners added. Use emitter.setMaxListeners() to increase limit.";if(this.verboseMemoryLeak&&(i+=" Event name: "+t+"."),"undefined"!=typeof process&&process.emitWarning){var s=new Error(i);s.name="MaxListenersExceededWarning",s.emitter=this,s.count=e,process.emitWarning(s)}else console.error(i),console.trace&&console.trace()}var u=function(e,t,i){var s=arguments.length;switch(s){case 0:return[];case 1:return[e];case 2:return[e,t];case 3:return[e,t,i];default:for(var r=new Array(s);s--;)r[s]=arguments[s];return r}};function p(t,i){for(var s={},r=t.length,o=i?value.length:0,n=0;n<r;n++)s[t[n]]=n<o?i[n]:e;return s}function d(e,t,i){var s,r;if(this._emitter=e,this._target=t,this._listeners={},this._listenersCount=0,(i.on||i.off)&&(s=i.on,r=i.off),t.addEventListener?(s=t.addEventListener,r=t.removeEventListener):t.addListener?(s=t.addListener,r=t.removeListener):t.on&&(s=t.on,r=t.off),!s&&!r)throw Error("target does not implement any known event API");if("function"!=typeof s)throw TypeError("on method must be a function");if("function"!=typeof r)throw TypeError("off method must be a function");this._on=s,this._off=r;var o=e._observers;o?o.push(this):e._observers=[this]}function f(i,s,r,o){var n=Object.assign({},s);if(!i)return n;if("object"!=typeof i)throw TypeError("options must be an object");var a,c,h,l=Object.keys(i),u=l.length;function p(e){throw Error('Invalid "'+a+'" option value'+(e?". Reason: "+e:""))}for(var d=0;d<u;d++){if(a=l[d],!o&&!t.call(s,a))throw Error('Unknown "'+a+'" option');(c=i[a])!==e&&(h=r[a],n[a]=h?h(c,p):c)}return n}function m(e,t){return"function"==typeof e&&e.hasOwnProperty("prototype")||t("value must be a constructor"),e}function v(e){var t="value must be type of "+e.join("|"),i=e.length,s=e[0],r=e[1];return 1===i?function(e,i){if(typeof e===s)return e;i(t)}:2===i?function(e,i){var o=typeof e;if(o===s||o===r)return e;i(t)}:function(s,r){for(var o=typeof s,n=i;n-- >0;)if(o===e[n])return s;r(t)}}Object.assign(d.prototype,{subscribe:function(e,t,i){var s=this,r=this._target,o=this._emitter,n=this._listeners,a=function(){var s=u.apply(null,arguments),n={data:s,name:t,original:e};if(i){var a=i.call(r,n);!1!==a&&o.emit.apply(o,[n.name].concat(s))}else o.emit.apply(o,[t].concat(s))};if(n[e])throw Error("Event '"+e+"' is already listening");this._listenersCount++,o._newListener&&o._removeListener&&!s._onNewListener?(this._onNewListener=function(i){i===t&&null===n[e]&&(n[e]=a,s._on.call(r,e,a))},o.on("newListener",this._onNewListener),this._onRemoveListener=function(i){i===t&&!o.hasListeners(i)&&n[e]&&(n[e]=null,s._off.call(r,e,a))},n[e]=null,o.on("removeListener",this._onRemoveListener)):(n[e]=a,s._on.call(r,e,a))},unsubscribe:function(e){var t,i,s,r=this,o=this._listeners,n=this._emitter,c=this._off,h=this._target;if(e&&"string"!=typeof e)throw TypeError("event must be a string");function l(){r._onNewListener&&(n.off("newListener",r._onNewListener),n.off("removeListener",r._onRemoveListener),r._onNewListener=null,r._onRemoveListener=null);var e=w.call(n,r);n._observers.splice(e,1)}if(e){if(!(t=o[e]))return;c.call(h,e,t),delete o[e],--this._listenersCount||l()}else{for(s=(i=a(o)).length;s-- >0;)e=i[s],c.call(h,e,o[e]);this._listeners={},this._listenersCount=0,l()}}});var g=v(["function"]),b=v(["object","function"]);function y(e,t,i){var s,r,o,n=0,a=new e((function(c,h,l){function u(){r&&(r=null),n&&(clearTimeout(n),n=0)}i=f(i,{timeout:0,overload:!1},{timeout:function(e,t){return("number"!=typeof(e*=1)||e<0||!Number.isFinite(e))&&t("timeout must be a positive number"),e}}),s=!i.overload&&"function"==typeof e.prototype.cancel&&"function"==typeof l;var p=function(e){u(),c(e)},d=function(e){u(),h(e)};s?t(p,d,l):(r=[function(e){d(e||Error("canceled"))}],t(p,d,(function(e){if(o)throw Error("Unable to subscribe on cancel event asynchronously");if("function"!=typeof e)throw TypeError("onCancel callback must be a function");r.push(e)})),o=!0),i.timeout>0&&(n=setTimeout((function(){var e=Error("timeout");e.code="ETIMEDOUT",n=0,a.cancel(e),h(e)}),i.timeout))}));return s||(a.cancel=function(e){if(r){for(var t=r.length,i=1;i<t;i++)r[i](e);r[0](e),r=null}}),a}function w(e){var t=this._observers;if(!t)return-1;for(var i=t.length,s=0;s<i;s++)if(t[s]._target===e)return s;return-1}function x(e,t,i,s,r){if(!i)return null;if(0===s){var o=typeof t;if("string"===o){var n,c,h=0,l=0,u=this.delimiter,p=u.length;if(-1!==(c=t.indexOf(u))){n=new Array(5);do{n[h++]=t.slice(l,c),l=c+p}while(-1!==(c=t.indexOf(u,l)));n[h++]=t.slice(l),t=n,r=h}else t=[t],r=1}else"object"===o?r=t.length:(t=[t],r=1)}var d,f,m,v,g,b,y,w=null,_=t[s],M=t[s+1];if(s===r&&i._listeners)return"function"==typeof i._listeners?(e&&e.push(i._listeners),[i]):(e&&e.push.apply(e,i._listeners),[i]);if("*"===_){for(c=(b=a(i)).length;c-- >0;)"_listeners"!==(d=b[c])&&(y=x(e,t,i[d],s+1,r))&&(w?w.push.apply(w,y):w=y);return w}if("**"===_){for((g=s+1===r||s+2===r&&"*"===M)&&i._listeners&&(w=x(e,t,i,r,r)),c=(b=a(i)).length;c-- >0;)"_listeners"!==(d=b[c])&&("*"===d||"**"===d?(i[d]._listeners&&!g&&(y=x(e,t,i[d],r,r))&&(w?w.push.apply(w,y):w=y),y=x(e,t,i[d],s,r)):y=x(e,t,i[d],d===M?s+2:s,r),y&&(w?w.push.apply(w,y):w=y));return w}if(i[_]&&(w=x(e,t,i[_],s+1,r)),(f=i["*"])&&x(e,t,f,s+1,r),m=i["**"])if(s<r)for(m._listeners&&x(e,t,m,r,r),c=(b=a(m)).length;c-- >0;)"_listeners"!==(d=b[c])&&(d===M?x(e,t,m[d],s+2,r):d===_?x(e,t,m[d],s+1,r):((v={})[d]=m[d],x(e,t,{"**":v},s+1,r)));else m._listeners?x(e,t,m,r,r):m["*"]&&m["*"]._listeners&&x(e,t,m["*"],r,r);return w}function _(e,t,i){var s,r,o=0,n=0,a=this.delimiter,c=a.length;if("string"==typeof e)if(-1!==(s=e.indexOf(a))){r=new Array(5);do{r[o++]=e.slice(n,s),n=s+c}while(-1!==(s=e.indexOf(a,n)));r[o++]=e.slice(n)}else r=[e],o=1;else r=e,o=e.length;if(o>1)for(s=0;s+1<o;s++)if("**"===r[s]&&"**"===r[s+1])return;var h,u=this.listenerTree;for(s=0;s<o;s++)if(u=u[h=r[s]]||(u[h]={}),s===o-1)return u._listeners?("function"==typeof u._listeners&&(u._listeners=[u._listeners]),i?u._listeners.unshift(t):u._listeners.push(t),!u._listeners.warned&&this._maxListeners>0&&u._listeners.length>this._maxListeners&&(u._listeners.warned=!0,l.call(this,u._listeners.length,h))):u._listeners=t,!0;return!0}function M(e,t,i,s){for(var r,o,n,c,h=a(e),l=h.length,u=e._listeners;l-- >0;)r=e[o=h[l]],n="_listeners"===o?i:i?i.concat(o):[o],c=s||"symbol"==typeof o,u&&t.push(c?n:n.join(this.delimiter)),"object"==typeof r&&M.call(this,r,t,n,c);return t}function T(e){for(var t,i,s,r=a(e),o=r.length;o-- >0;)(t=e[i=r[o]])&&(s=!0,"_listeners"===i||T(t)||delete e[i]);return s}function k(e,t,i){this.emitter=e,this.event=t,this.listener=i}function E(t,i,r){if(!0===r)a=!0;else if(!1===r)o=!0;else{if(!r||"object"!=typeof r)throw TypeError("options should be an object or true");var o=r.async,a=r.promisify,c=r.nextTick,h=r.objectify}if(o||c||a){var l=i,u=i._origin||i;if(c&&!s)throw Error("process.nextTick is not supported");a===e&&(a="AsyncFunction"===i.constructor.name),(i=function(){var e=arguments,t=this,i=this.event;return a?c?Promise.resolve():new Promise((function(e){n(e)})).then((function(){return t.event=i,l.apply(t,e)})):(c?process.nextTick:n)((function(){t.event=i,l.apply(t,e)}))})._async=!0,i._origin=u}return[i,h?new k(this,t,i):this]}function A(e){this._events={},this._newListener=!1,this._removeListener=!1,this.verboseMemoryLeak=!1,h.call(this,e)}k.prototype.off=function(){return this.emitter.off(this.event,this.listener),this},A.EventEmitter2=A,A.prototype.listenTo=function(t,s,r){if("object"!=typeof t)throw TypeError("target musts be an object");var o=this;function n(e){if("object"!=typeof e)throw TypeError("events must be an object");var i,s=r.reducers,n=w.call(o,t);i=-1===n?new d(o,t,r):o._observers[n];for(var c,h=a(e),l=h.length,u="function"==typeof s,p=0;p<l;p++)c=h[p],i.subscribe(c,e[c]||c,u?s:s&&s[c])}return r=f(r,{on:e,off:e,reducers:e},{on:g,off:g,reducers:b}),i(s)?n(p(s)):n("string"==typeof s?p(s.split(/\s+/)):s),this},A.prototype.stopListeningTo=function(e,t){var i=this._observers;if(!i)return!1;var s,r=i.length,o=!1;if(e&&"object"!=typeof e)throw TypeError("target should be an object");for(;r-- >0;)s=i[r],e&&s._target!==e||(s.unsubscribe(t),o=!0);return o},A.prototype.delimiter=".",A.prototype.setMaxListeners=function(t){t!==e&&(this._maxListeners=t,this._conf||(this._conf={}),this._conf.maxListeners=t)},A.prototype.getMaxListeners=function(){return this._maxListeners},A.prototype.event="",A.prototype.once=function(e,t,i){return this._once(e,t,!1,i)},A.prototype.prependOnceListener=function(e,t,i){return this._once(e,t,!0,i)},A.prototype._once=function(e,t,i,s){return this._many(e,1,t,i,s)},A.prototype.many=function(e,t,i,s){return this._many(e,t,i,!1,s)},A.prototype.prependMany=function(e,t,i,s){return this._many(e,t,i,!0,s)},A.prototype._many=function(e,t,i,s,r){var o=this;if("function"!=typeof i)throw new Error("many only accepts instances of Function");function n(){return 0==--t&&o.off(e,n),i.apply(this,arguments)}return n._origin=i,this._on(e,n,s,r)},A.prototype.emit=function(){if(!this._events&&!this._all)return!1;this._events||c.call(this);var e,t,i,s,o,n,a=arguments[0],h=this.wildcard;if("newListener"===a&&!this._newListener&&!this._events.newListener)return!1;if(h&&(e=a,"newListener"!==a&&"removeListener"!==a&&"object"==typeof a)){if(i=a.length,r)for(s=0;s<i;s++)if("symbol"==typeof a[s]){n=!0;break}n||(a=a.join(this.delimiter))}var l,u=arguments.length;if(this._all&&this._all.length)for(s=0,i=(l=this._all.slice()).length;s<i;s++)switch(this.event=a,u){case 1:l[s].call(this,a);break;case 2:l[s].call(this,a,arguments[1]);break;case 3:l[s].call(this,a,arguments[1],arguments[2]);break;default:l[s].apply(this,arguments)}if(h)l=[],x.call(this,l,e,this.listenerTree,0,i);else{if("function"==typeof(l=this._events[a])){switch(this.event=a,u){case 1:l.call(this);break;case 2:l.call(this,arguments[1]);break;case 3:l.call(this,arguments[1],arguments[2]);break;default:for(t=new Array(u-1),o=1;o<u;o++)t[o-1]=arguments[o];l.apply(this,t)}return!0}l&&(l=l.slice())}if(l&&l.length){if(u>3)for(t=new Array(u-1),o=1;o<u;o++)t[o-1]=arguments[o];for(s=0,i=l.length;s<i;s++)switch(this.event=a,u){case 1:l[s].call(this);break;case 2:l[s].call(this,arguments[1]);break;case 3:l[s].call(this,arguments[1],arguments[2]);break;default:l[s].apply(this,t)}return!0}if(!this.ignoreErrors&&!this._all&&"error"===a)throw arguments[1]instanceof Error?arguments[1]:new Error("Uncaught, unspecified 'error' event.");return!!this._all},A.prototype.emitAsync=function(){if(!this._events&&!this._all)return!1;this._events||c.call(this);var e,t,i,s,o,n,a=arguments[0],h=this.wildcard;if("newListener"===a&&!this._newListener&&!this._events.newListener)return Promise.resolve([!1]);if(h&&(e=a,"newListener"!==a&&"removeListener"!==a&&"object"==typeof a)){if(s=a.length,r)for(o=0;o<s;o++)if("symbol"==typeof a[o]){t=!0;break}t||(a=a.join(this.delimiter))}var l,u=[],p=arguments.length;if(this._all)for(o=0,s=this._all.length;o<s;o++)switch(this.event=a,p){case 1:u.push(this._all[o].call(this,a));break;case 2:u.push(this._all[o].call(this,a,arguments[1]));break;case 3:u.push(this._all[o].call(this,a,arguments[1],arguments[2]));break;default:u.push(this._all[o].apply(this,arguments))}if(h?(l=[],x.call(this,l,e,this.listenerTree,0)):l=this._events[a],"function"==typeof l)switch(this.event=a,p){case 1:u.push(l.call(this));break;case 2:u.push(l.call(this,arguments[1]));break;case 3:u.push(l.call(this,arguments[1],arguments[2]));break;default:for(i=new Array(p-1),n=1;n<p;n++)i[n-1]=arguments[n];u.push(l.apply(this,i))}else if(l&&l.length){if(l=l.slice(),p>3)for(i=new Array(p-1),n=1;n<p;n++)i[n-1]=arguments[n];for(o=0,s=l.length;o<s;o++)switch(this.event=a,p){case 1:u.push(l[o].call(this));break;case 2:u.push(l[o].call(this,arguments[1]));break;case 3:u.push(l[o].call(this,arguments[1],arguments[2]));break;default:u.push(l[o].apply(this,i))}}else if(!this.ignoreErrors&&!this._all&&"error"===a)return arguments[1]instanceof Error?Promise.reject(arguments[1]):Promise.reject("Uncaught, unspecified 'error' event.");return Promise.all(u)},A.prototype.on=function(e,t,i){return this._on(e,t,!1,i)},A.prototype.prependListener=function(e,t,i){return this._on(e,t,!0,i)},A.prototype.onAny=function(e){return this._onAny(e,!1)},A.prototype.prependAny=function(e){return this._onAny(e,!0)},A.prototype.addListener=A.prototype.on,A.prototype._onAny=function(e,t){if("function"!=typeof e)throw new Error("onAny only accepts instances of Function");return this._all||(this._all=[]),t?this._all.unshift(e):this._all.push(e),this},A.prototype._on=function(t,i,s,r){if("function"==typeof t)return this._onAny(t,i),this;if("function"!=typeof i)throw new Error("on only accepts instances of Function");this._events||c.call(this);var o,n=this;return r!==e&&(i=(o=E.call(this,t,i,r))[0],n=o[1]),this._newListener&&this.emit("newListener",t,i),this.wildcard?(_.call(this,t,i,s),n):(this._events[t]?("function"==typeof this._events[t]&&(this._events[t]=[this._events[t]]),s?this._events[t].unshift(i):this._events[t].push(i),!this._events[t].warned&&this._maxListeners>0&&this._events[t].length>this._maxListeners&&(this._events[t].warned=!0,l.call(this,this._events[t].length,t))):this._events[t]=i,n)},A.prototype.off=function(e,t){if("function"!=typeof t)throw new Error("removeListener only takes instances of Function");var s,r=[];if(this.wildcard){var o="string"==typeof e?e.split(this.delimiter):e.slice();if(!(r=x.call(this,null,o,this.listenerTree,0)))return this}else{if(!this._events[e])return this;s=this._events[e],r.push({_listeners:s})}for(var n=0;n<r.length;n++){var a=r[n];if(s=a._listeners,i(s)){for(var c=-1,h=0,l=s.length;h<l;h++)if(s[h]===t||s[h].listener&&s[h].listener===t||s[h]._origin&&s[h]._origin===t){c=h;break}if(c<0)continue;return this.wildcard?a._listeners.splice(c,1):this._events[e].splice(c,1),0===s.length&&(this.wildcard?delete a._listeners:delete this._events[e]),this._removeListener&&this.emit("removeListener",e,t),this}(s===t||s.listener&&s.listener===t||s._origin&&s._origin===t)&&(this.wildcard?delete a._listeners:delete this._events[e],this._removeListener&&this.emit("removeListener",e,t))}return this.listenerTree&&T(this.listenerTree),this},A.prototype.offAny=function(e){var t,i=0,s=0;if(e&&this._all&&this._all.length>0){for(i=0,s=(t=this._all).length;i<s;i++)if(e===t[i])return t.splice(i,1),this._removeListener&&this.emit("removeListenerAny",e),this}else{if(t=this._all,this._removeListener)for(i=0,s=t.length;i<s;i++)this.emit("removeListenerAny",t[i]);this._all=[]}return this},A.prototype.removeListener=A.prototype.off,A.prototype.removeAllListeners=function(t){if(t===e)return!this._events||c.call(this),this;if(this.wildcard){var i,s=x.call(this,null,t,this.listenerTree,0);if(!s)return this;for(i=0;i<s.length;i++)s[i]._listeners=null;this.listenerTree&&T(this.listenerTree)}else this._events&&(this._events[t]=null);return this},A.prototype.listeners=function(t){var i,s,r,o,n,c=this._events;if(t===e){if(this.wildcard)throw Error("event name required for wildcard emitter");if(!c)return[];for(o=(i=a(c)).length,r=[];o-- >0;)"function"==typeof(s=c[i[o]])?r.push(s):r.push.apply(r,s);return r}if(this.wildcard){if(!(n=this.listenerTree))return[];var h=[],l="string"==typeof t?t.split(this.delimiter):t.slice();return x.call(this,h,l,n,0),h}return c&&(s=c[t])?"function"==typeof s?[s]:s:[]},A.prototype.eventNames=function(e){var t=this._events;return this.wildcard?M.call(this,this.listenerTree,[],null,e):t?a(t):[]},A.prototype.listenerCount=function(e){return this.listeners(e).length},A.prototype.hasListeners=function(t){if(this.wildcard){var i=[],s="string"==typeof t?t.split(this.delimiter):t.slice();return x.call(this,i,s,this.listenerTree,0),i.length>0}var r=this._events,o=this._all;return!!(o&&o.length||r&&(t===e?a(r).length:r[t]))},A.prototype.listenersAny=function(){return this._all?this._all:[]},A.prototype.waitFor=function(t,i){var s=this,r=typeof i;return"number"===r?i={timeout:i}:"function"===r&&(i={filter:i}),y((i=f(i,{timeout:0,filter:e,handleError:!1,Promise:Promise,overload:!1},{filter:g,Promise:m})).Promise,(function(e,r,o){function n(){var o=i.filter;if(!o||o.apply(s,arguments))if(s.off(t,n),i.handleError){var a=arguments[0];a?r(a):e(u.apply(null,arguments).slice(1))}else e(u.apply(null,arguments))}o((function(){s.off(t,n)})),s._on(t,n,!1)}),{timeout:i.timeout,overload:i.overload})};var C=A.prototype;Object.defineProperties(A,{defaultMaxListeners:{get:function(){return C._maxListeners},set:function(e){if("number"!=typeof e||e<0||Number.isNaN(e))throw TypeError("n must be a non-negative number");C._maxListeners=e},enumerable:!0},once:{value:function(e,t,i){return y((i=f(i,{Promise:Promise,timeout:0,overload:!1},{Promise:m})).Promise,(function(i,s,r){var o;if("function"==typeof e.addEventListener)return o=function(){i(u.apply(null,arguments))},r((function(){e.removeEventListener(t,o)})),void e.addEventListener(t,o,{once:!0});var n,a=function(){n&&e.removeListener("error",n),i(u.apply(null,arguments))};"error"!==t&&(n=function(i){e.removeListener(t,a),s(i)},e.once("error",n)),r((function(){n&&e.removeListener("error",n),e.removeListener(t,a)})),e.once(t,a)}),{timeout:i.timeout,overload:i.overload})},writable:!0,configurable:!0}}),Object.defineProperties(C,{_maxListeners:{value:10,writable:!0,configurable:!0},_observers:{value:null,writable:!0,configurable:!0}}),L.exports=A}();var j=N.exports;class O extends j{constructor(e){super(),e=e||{},this.message=e.message,this.feedbackTopic=e.feedbackTopic,this.tfClient=e.tfClient,this.menuFontSize=e.menuFontSize||"0.8em",this.name=this.message.name,this.header=this.message.header,this.controls=this.message.controls,this.menuEntries=this.message.menu_entries,this.dragging=!1,this.timeoutHandle=null,this.tfTransform=new c.Transform,this.pose=new c.Pose,this.setPoseFromClientBound=this.setPoseFromClient.bind(this),this.onMouseDownBound=this.onMouseDown.bind(this),this.onMouseUpBound=this.onMouseUp.bind(this),this.onButtonClickBound=this.onButtonClick.bind(this),this.onMenuSelectBound=this.onMenuSelect.bind(this),this.setPoseFromServer(this.message.pose),this.tfUpdateBound=this.tfUpdate.bind(this)}subscribeTf(){0===this.message.header.stamp.secs&&0===this.message.header.stamp.nsecs&&this.tfClient.subscribe(this.message.header.frame_id,this.tfUpdateBound)}unsubscribeTf(){this.tfClient.unsubscribe(this.message.header.frame_id,this.tfUpdateBound)}emitServerPoseUpdate(){var e=new c.Pose(this.pose);e.applyTransform(this.tfTransform),this.emit("pose",e)}setPoseFromServer(e){this.pose=new c.Pose(e),this.emitServerPoseUpdate()}tfUpdate(e){this.tfTransform=new c.Transform(e),this.emitServerPoseUpdate()}setPoseFromClient(e){this.pose=new c.Pose(e);var t=this.tfTransform.clone();t.rotation.invert(),t.translation.multiplyQuaternion(t.rotation),t.translation.x*=-1,t.translation.y*=-1,t.translation.z*=-1,this.pose.applyTransform(t),this.sendFeedback(1,void 0,0,e.controlName),this.dragging&&(this.timeoutHandle&&clearTimeout(this.timeoutHandle),this.timeoutHandle=setTimeout(this.setPoseFromClient.bind(this,e),250))}onButtonClick(e){this.sendFeedback(3,e.clickPosition,0,e.controlName)}onMouseDown(e){this.sendFeedback(4,e.clickPosition,0,e.controlName),this.dragging=!0}onMouseUp(e){this.sendFeedback(5,e.clickPosition,0,e.controlName),this.dragging=!1,this.timeoutHandle&&clearTimeout(this.timeoutHandle)}onMenuSelect(e){this.sendFeedback(2,void 0,e.id,e.controlName)}sendFeedback(e,t,i,s){var r=void 0!==t;t=t||{x:0,y:0,z:0};var o={header:this.header,client_id:this.clientID,marker_name:this.name,control_name:s,event_type:e,pose:this.pose,mouse_point:t,mouse_point_valid:r,menu_entry_id:i};this.feedbackTopic.publish(o)}}class P extends h.Object3D{constructor(e){super(),e=e||{};var t=this;this.tfClient=e.tfClient,this.frameID=e.frameID;var i=e.object;this.pose=e.pose||new c.Pose,this.visible=!1,this.add(i),this.updatePose(this.pose),this.tfUpdate=function(e){var i=new c.Transform(e),s=new c.Pose(t.pose);s.applyTransform(i),t.updatePose(s),t.visible=!0},this.tfClient.subscribe(this.frameID,this.tfUpdate)}updatePose(e){this.position.set(e.position.x,e.position.y,e.position.z),this.quaternion.set(e.orientation.x,e.orientation.y,e.orientation.z,e.orientation.w),this.updateMatrixWorld(!0)}unsubscribeTf(){this.tfClient.unsubscribe(this.frameID,this.tfUpdate)}}class R extends h.ArrowHelper{constructor(e){var t=(e=e||{}).origin||new h.Vector3(0,0,0),i=e.direction||new h.Vector3(1,0,0),s=e.length||1;e.headLength,e.shaftDiameter,e.headDiameter,e.material||new h.MeshBasicMaterial,super(i,t,s,16711680)}dispose(){void 0!==this.line&&(this.line.material.dispose(),this.line.geometry.dispose()),void 0!==this.cone&&(this.cone.material.dispose(),this.cone.geometry.dispose())}}class S extends h.Object3D{constructor(e){super();var t=this,i=(e=e||{}).shaftRadius||.008,s=e.headRadius||.023,r=e.headLength||.1,o=e.scale||1,n=e.lineType||"full",a=e.lineDashLength||.1;function c(e){var s=new h.Color;s.setRGB(e.x,e.y,e.z);var r=new h.MeshBasicMaterial({color:s.getHex()}),o=new h.Vector3;o.crossVectors(e,new h.Vector3(0,-1,0));var c=new h.Quaternion;c.setFromAxisAngle(o,.5*Math.PI);var l,u=new h.Mesh(t.headGeom,r);if(u.position.copy(e),u.position.multiplyScalar(.95),u.quaternion.copy(c),u.updateMatrix(),t.add(u),"dashed"===n)for(var p=a,d=0;p/2+3*p*d+p/2<=1;++d){var f=new h.CylinderGeometry(i,i,p);(l=new h.Mesh(f,r)).position.copy(e),l.position.multiplyScalar(p/2+3*p*d),l.quaternion.copy(c),l.updateMatrix(),t.add(l)}else"full"===n?((l=new h.Mesh(t.lineGeom,r)).position.copy(e),l.position.multiplyScalar(.45),l.quaternion.copy(c),l.updateMatrix(),t.add(l)):console.warn("[Axes]: Unsupported line type. Not drawing any axes.")}this.scale.set(o,o,o),this.lineGeom=new h.CylinderGeometry(i,i,1-r),this.headGeom=new h.CylinderGeometry(0,s,r),c(new h.Vector3(1,0,0)),c(new h.Vector3(0,1,0)),c(new h.Vector3(0,0,1))}}class D extends h.Object3D{constructor(e){var t=(e=e||{}).num_cells||10,i=e.color||"#cccccc",s=e.lineWidth||1,r=e.cellSize||1;super();for(var o=new h.LineBasicMaterial({color:i,linewidth:s}),n=0;n<=t;++n){var a=r*t/2,c=a-n*r;const e=(new h.BufferGeometry).setFromPoints([new h.Vector3(-a,c,0),new h.Vector3(a,c,0)]);var l=(new h.BufferGeometry).setFromPoints([new h.Vector3(c,-a,0),new h.Vector3(c,a,0)]);this.add(new h.Line(e,o)),this.add(new h.Line(l,o))}}}class V extends h.Mesh{constructor(e){var t=(e=e||{}).message,i=e.opacity||1,s=e.color||{r:255,g:255,b:255,a:255},r=t.info,o=r.origin,n=r.width,a=r.height,c=new h.PlaneBufferGeometry(n,a),l=new Uint8Array(n*a*4),u=new h.DataTexture(l,n,a,h.RGBAFormat);u.flipY=!0,u.minFilter=h.NearestFilter,u.magFilter=h.NearestFilter,u.needsUpdate=!0;var p=new h.MeshBasicMaterial({map:u,transparent:i<1,opacity:i});p.side=h.DoubleSide,super(c,p),Object.assign(this,e),this.quaternion.copy(new h.Quaternion(o.orientation.x,o.orientation.y,o.orientation.z,o.orientation.w)),this.position.x=n*r.resolution/2+o.position.x,this.position.y=a*r.resolution/2+o.position.y,this.position.z=o.position.z,this.scale.x=r.resolution,this.scale.y=r.resolution;var d=t.data;this.color=s,this.material=p,this.texture=u;for(var f=0;f<a;f++)for(var m=0;m<n;m++){var v=a-f-1,g=m+v*n,b=this.getValue(g,v,m,d),y=(s=this.getColor(g,v,m,b),4*(m+f*n));l.set(s,y)}u.needsUpdate=!0}dispose(){this.material.dispose(),this.texture.dispose()}getValue(e,t,i,s){return s[e]}getColor(e,t,i,s){return[s*this.color.r/255,s*this.color.g/255,s*this.color.b/255,255]}}class F extends h.Object3D{constructor(e){super(),this.options=e||{},this.ros=e.ros,this.topicName=e.topic||"/particlecloud",this.tfClient=e.tfClient,this.color=e.color||13369599,this.length=e.length||1,this.rootObject=e.rootObject||new h.Object3D,this.keep=e.keep||1,this.sns=[],this.rosTopic=void 0,this.subscribe()}unsubscribe(){this.rosTopic&&this.rosTopic.unsubscribe()}subscribe(){this.unsubscribe(),this.rosTopic=new c.Topic({ros:this.ros,name:this.topicName,queue_length:1,messageType:"nav_msgs/Odometry"}),this.rosTopic.subscribe(this.processMessage.bind(this))}processMessage(e){this.sns.length>=this.keep&&(this.sns[0].unsubscribeTf(),this.rootObject.remove(this.sns[0]),this.sns.shift()),this.options.origin=new h.Vector3(e.pose.pose.position.x,e.pose.pose.position.y,e.pose.pose.position.z);var t=new h.Quaternion(e.pose.pose.orientation.x,e.pose.pose.orientation.y,e.pose.pose.orientation.z,e.pose.pose.orientation.w);this.options.direction=new h.Vector3(1,0,0),this.options.direction.applyQuaternion(t),this.options.material=new h.MeshBasicMaterial({color:this.color});var i=new m(this.options);this.sns.push(new P({frameID:e.header.frame_id,tfClient:this.tfClient,object:i})),this.rootObject.add(this.sns[this.sns.length-1])}}class I extends h.Object3D{constructor(e){super(),e=e||{},this.ros=e.ros,this.topicName=e.topic||"/path",this.tfClient=e.tfClient,this.color=e.color||13369599,this.rootObject=e.rootObject||new h.Object3D,this.sn=null,this.line=null,this.rosTopic=void 0,this.subscribe()}unsubscribe(){this.rosTopic&&this.rosTopic.unsubscribe()}subscribe(){this.unsubscribe(),this.rosTopic=new c.Topic({ros:this.ros,name:this.topicName,queue_length:1,messageType:"nav_msgs/Path"}),this.rosTopic.subscribe(this.processMessage.bind(this))}processMessage(e){null!==this.sn&&(this.sn.unsubscribeTf(),this.rootObject.remove(this.sn));for(var t=new h.Geometry,i=0;i<e.poses.length;i++){var s=new h.Vector3(e.poses[i].pose.position.x,e.poses[i].pose.position.y,e.poses[i].pose.position.z);t.vertices.push(s)}t.computeLineDistances();var r=new h.LineBasicMaterial({color:this.color}),o=new h.Line(t,r);this.sn=new P({frameID:e.header.frame_id,tfClient:this.tfClient,object:o}),this.rootObject.add(this.sn)}}class z extends h.Object3D{constructor(e){super(),this.options=e||{},this.ros=e.ros,this.topicName=e.topic||"/point",this.tfClient=e.tfClient,this.color=e.color||13369599,this.rootObject=e.rootObject||new h.Object3D,this.radius=e.radius||.2,this.sn=null,this.rosTopic=void 0,this.subscribe()}unsubscribe(){this.rosTopic&&this.rosTopic.unsubscribe()}subscribe(){this.unsubscribe(),this.rosTopic=new c.Topic({ros:this.ros,name:this.topicName,queue_length:1,messageType:"geometry_msgs/PointStamped"}),this.rosTopic.subscribe(this.processMessage.bind(this))}processMessage(e){null!==this.sn&&(this.sn.unsubscribeTf(),this.rootObject.remove(this.sn));var t=new h.SphereGeometry(this.radius),i=new h.MeshBasicMaterial({color:this.color}),s=new h.Mesh(t,i);s.position.set(e.point.x,e.point.y,e.point.z),this.sn=new P({frameID:e.header.frame_id,tfClient:this.tfClient,object:s}),this.rootObject.add(this.sn)}}class U extends h.Object3D{constructor(e){super(),e=e||{},this.ros=e.ros,this.topicName=e.topic||"/path",this.tfClient=e.tfClient,this.color=e.color||13369599,this.rootObject=e.rootObject||new h.Object3D,this.sn=null,this.line=null,this.rosTopic=void 0,this.subscribe()}unsubscribe(){this.rosTopic&&this.rosTopic.unsubscribe()}subscribe(){this.unsubscribe(),this.rosTopic=new c.Topic({ros:this.ros,name:this.topicName,queue_length:1,messageType:"geometry_msgs/PolygonStamped"}),this.rosTopic.subscribe(this.processMessage.bind(this))}processMessage(e){null!==this.sn&&(this.sn.unsubscribeTf(),this.rootObject.remove(this.sn));for(var t,i=new h.Geometry,s=0;s<e.polygon.points.length;s++)t=new h.Vector3(e.polygon.points[s].x,e.polygon.points[s].y,e.polygon.points[s].z),i.vertices.push(t);t=new h.Vector3(e.polygon.points[0].x,e.polygon.points[0].y,e.polygon.points[0].z),i.vertices.push(t),i.computeLineDistances();var r=new h.LineBasicMaterial({color:this.color}),o=new h.Line(i,r);this.sn=new P({frameID:e.header.frame_id,tfClient:this.tfClient,object:o}),this.rootObject.add(this.sn)}}class B extends h.Object3D{constructor(e){super(),this.options=e||{},this.ros=e.ros,this.topicName=e.topic||"/pose",this.tfClient=e.tfClient,this.color=e.color||13369599,this.rootObject=e.rootObject||new h.Object3D,this.sn=null,this.rosTopic=void 0,this.subscribe()}unsubscribe(){this.rosTopic&&this.rosTopic.unsubscribe()}subscribe(){this.unsubscribe(),this.rosTopic=new c.Topic({ros:this.ros,name:this.topicName,queue_length:1,messageType:"geometry_msgs/PoseStamped"}),this.rosTopic.subscribe(this.processMessage.bind(this))}processMessage(e){null!==this.sn&&(this.sn.unsubscribeTf(),this.rootObject.remove(this.sn)),this.options.origin=new h.Vector3(e.pose.position.x,e.pose.position.y,e.pose.position.z);var t=new h.Quaternion(e.pose.orientation.x,e.pose.orientation.y,e.pose.orientation.z,e.pose.orientation.w);this.options.direction=new h.Vector3(1,0,0),this.options.direction.applyQuaternion(t),this.options.material=new h.MeshBasicMaterial({color:this.color});var i=new m(this.options);this.sn=new P({frameID:e.header.frame_id,tfClient:this.tfClient,object:i}),this.rootObject.add(this.sn)}}class G extends h.Object3D{constructor(e){super(),this.options=e||{},this.ros=e.ros,this.topicName=e.topic||"/particlecloud",this.tfClient=e.tfClient,this.color=e.color||13369599,this.length=e.length||1,this.rootObject=e.rootObject||new h.Object3D,this.sn=null,this.rosTopic=void 0,this.subscribe()}unsubscribe(){this.rosTopic&&this.rosTopic.unsubscribe()}subscribe(){this.unsubscribe(),this.rosTopic=new c.Topic({ros:this.ros,name:this.topicName,queue_length:1,messageType:"geometry_msgs/PoseArray"}),this.rosTopic.subscribe(this.processMessage.bind(this))}processMessage(e){null!==this.sn&&(this.sn.unsubscribeTf(),this.rootObject.remove(this.sn));for(var t,i=new h.Object3D,s=0;s<e.poses.length;s++){var r=new h.Geometry,o=new h.Vector3(e.poses[s].position.x,e.poses[s].position.y,e.poses[s].position.z);r.vertices.push(o);var n=new h.Quaternion(e.poses[s].orientation.x,e.poses[s].orientation.y,e.poses[s].orientation.z,e.poses[s].orientation.w),a=new h.Vector3(this.length,0,0),c=new h.Vector3(.8*this.length,.2*this.length,0),l=new h.Vector3(.8*this.length,.2*-this.length,0);a.applyQuaternion(n),c.applyQuaternion(n),l.applyQuaternion(n),r.vertices.push(a.add(o)),r.vertices.push(c.add(o)),r.vertices.push(l.add(o)),r.vertices.push(a),r.computeLineDistances();var u=new h.LineBasicMaterial({color:this.color});t=new h.Line(r,u),i.add(t)}this.sn=new P({frameID:e.header.frame_id,tfClient:this.tfClient,object:i}),this.rootObject.add(this.sn)}}class W extends h.Object3D{constructor(e){super(),this.options=e||{},this.ros=e.ros,this.topicName=e.topic||"/PoseWithCovariance",this.tfClient=e.tfClient,this.color=e.color||13369599,this.rootObject=e.rootObject||new h.Object3D,this.sn=null,this.rosTopic=void 0,this.subscribe()}unsubscribe(){this.rosTopic&&this.rosTopic.unsubscribe()}subscribe(){this.unsubscribe(),this.rosTopic=new c.Topic({ros:this.ros,name:this.topicName,queue_length:1,messageType:"geometry_msgs/PoseWithCovarianceStamped"}),this.rosTopic.subscribe(this.processMessage.bind(this))}processMessage(e){null!==this.sn&&(this.sn.unsubscribeTf(),this.rootObject.remove(this.sn)),this.options.origin=new h.Vector3(e.pose.pose.position.x,e.pose.pose.position.y,e.pose.pose.position.z);var t=new h.Quaternion(e.pose.pose.orientation.x,e.pose.pose.orientation.y,e.pose.pose.orientation.z,e.pose.pose.orientation.w);this.options.direction=new h.Vector3(1,0,0),this.options.direction.applyQuaternion(t),this.options.material=new h.MeshBasicMaterial({color:this.color});var i=new m(this.options);this.sn=new P({frameID:e.header.frame_id,tfClient:this.tfClient,object:i}),this.rootObject.add(this.sn)}}class q extends h.Object3D{constructor(e){super(),e=e||{},this.tfClient=e.tfClient,this.rootObject=e.rootObject||new h.Object3D,this.max_pts=e.max_pts||1e4,this.pointRatio=e.pointRatio||1,this.messageRatio=e.messageRatio||1,this.messageCount=0,this.material=e.material||{},this.colorsrc=e.colorsrc,this.colormap=e.colormap,("color"in e||"size"in e||"texture"in e)&&console.warn('toplevel "color", "size" and "texture" options are deprecated.They should beprovided within a "material" option, e.g. :  { tfClient, material : { color: mycolor, size: mysize, map: mytexture }, ... }'),this.sn=null}setup(e,t,i){if(null===this.sn){i=i||[],this.fields={};for(var s=0;s<i.length;s++)this.fields[i[s].name]=i[s];if(this.geom=new h.BufferGeometry,this.positions=new h.BufferAttribute(new Float32Array(3*this.max_pts),3,!1),this.geom.setAttribute("position",this.positions.setUsage(h.DynamicDrawUsage)),!this.colorsrc&&this.fields.rgb&&(this.colorsrc="rgb"),this.colorsrc){var r=this.fields[this.colorsrc];if(r){this.colors=new h.BufferAttribute(new Float32Array(3*this.max_pts),3,!1),this.geom.setAttribute("color",this.colors.setUsage(h.DynamicDrawUsage));var o=r.offset;this.getColor=[function(e,t,i){return e.getInt8(t+o,i)},function(e,t,i){return e.getUint8(t+o,i)},function(e,t,i){return e.getInt16(t+o,i)},function(e,t,i){return e.getUint16(t+o,i)},function(e,t,i){return e.getInt32(t+o,i)},function(e,t,i){return e.getUint32(t+o,i)},function(e,t,i){return e.getFloat32(t+o,i)},function(e,t,i){return e.getFloat64(t+o,i)}][r.datatype-1],this.colormap=this.colormap||function(e){return new h.Color(e)}}else console.warn('unavailable field "'+this.colorsrc+'" for coloring.')}this.material.isMaterial||(this.colors&&void 0===this.material.vertexColors&&(this.material.vertexColors=h.VertexColors),this.material=new h.PointsMaterial(this.material)),this.object=new h.Points(this.geom,this.material),this.sn=new P({frameID:e,tfClient:this.tfClient,object:this.object}),this.rootObject.add(this.sn)}return this.messageCount++%this.messageRatio==0}update(e){this.geom.setDrawRange(0,e),this.positions.needsUpdate=!0,this.positions.updateRange.count=e*this.positions.itemSize,this.colors&&(this.colors.needsUpdate=!0,this.colors.updateRange.count=e*this.colors.itemSize)}}class H extends h.Object3D{constructor(e){super(),e=e||{},this.ros=e.ros,this.topicName=e.topic||"/scan",this.compression=e.compression||"cbor",this.points=new q(e),this.rosTopic=void 0,this.subscribe()}unsubscribe(){this.rosTopic&&this.rosTopic.unsubscribe()}subscribe(){this.unsubscribe(),this.rosTopic=new c.Topic({ros:this.ros,name:this.topicName,compression:this.compression,queue_length:1,messageType:"sensor_msgs/LaserScan"}),this.rosTopic.subscribe(this.processMessage.bind(this))}processMessage(e){if(this.points.setup(e.header.frame_id)){for(var t=e.ranges.length,i=0,s=0;s<t;s+=this.points.pointRatio){var r=e.ranges[s];if(r>=e.range_min&&r<=e.range_max){var o=e.angle_min+s*e.angle_increment;this.points.positions.array[i++]=r*Math.cos(o),this.points.positions.array[i++]=r*Math.sin(o),this.points.positions.array[i++]=0}}this.points.update(i/3)}}}class K extends h.Object3D{constructor(e){super(),e=e||{},this.ros=e.ros,this.topicName=e.topic||"/gps/fix",this.rootObject=e.rootObject||new h.Object3D,this.object3d=e.object3d||new h.Object3D;var t=e.material||{};this.altitudeNaN=e.altitudeNaN||0,this.keep=e.keep||100,this.convert=e.convert||function(e,t,i){return new h.Vector3(e,t,i)},this.count=0,this.next1=0,this.next2=this.keep,this.geom=new h.BufferGeometry,this.vertices=new h.BufferAttribute(new Float32Array(6*this.keep),3),this.geom.setAttribute("position",this.vertices),this.material=t.isMaterial?t:new h.LineBasicMaterial(t),this.line=new h.Line(this.geom,this.material),this.rootObject.add(this.object3d),this.rootObject.add(this.line),this.rosTopic=void 0,this.subscribe()}unsubscribe(){this.rosTopic&&this.rosTopic.unsubscribe()}subscribe(){this.unsubscribe(),this.rosTopic=new c.Topic({ros:this.ros,name:this.topicName,queue_length:1,messageType:"sensor_msgs/NavSatFix"}),this.rosTopic.subscribe(this.processMessage.bind(this))}processMessage(e){var t=isNaN(e.altitude)?this.altitudeNaN:e.altitude,i=this.convert(e.longitude,e.latitude,t);this.object3d.position.copy(i),this.object3d.updateMatrixWorld(!0),this.vertices.array[3*this.next1]=i.x,this.vertices.array[3*this.next1+1]=i.y,this.vertices.array[3*this.next1+2]=i.z,this.vertices.array[3*this.next2]=i.x,this.vertices.array[3*this.next2+1]=i.y,this.vertices.array[3*this.next2+2]=i.z,this.vertices.needsUpdate=!0,this.next1=(this.next1+1)%this.keep,this.next2=this.next1+this.keep,this.count=Math.min(this.count+1,this.keep),this.geom.setDrawRange(this.next2-this.count,this.count)}}function Q(e,t,i,s){var r,o=0,n=0,a=0,c=e.length,h=t.length,l=((s=s||1)-1)*(i=i||h)*8;for(r=0;r<c&&a<h;r++)o=(o<<6)+Q.e[e.charAt(r)],(n+=6)>=8&&(n-=8,t[a++]=o>>>n&255,a%i==0&&(r+=Math.ceil((l-n)/6),(n%=8)>0&&(o=Q.e[e.charAt(r)])));return Math.floor(a/i)}Q.S="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Q.e={};for(var X=0;X<64;X++)Q.e[Q.S.charAt(X)]=X;class Y extends h.Object3D{constructor(e){super(),e=e||{},this.ros=e.ros,this.topicName=e.topic||"/points",this.throttle_rate=e.throttle_rate||null,this.compression=e.compression||"cbor",this.max_pts=e.max_pts||1e4,this.points=new q(e),this.rosTopic=void 0,this.buffer=null,this.subscribe()}unsubscribe(){this.rosTopic&&this.rosTopic.unsubscribe()}subscribe(){this.unsubscribe(),this.rosTopic=new c.Topic({ros:this.ros,name:this.topicName,messageType:"sensor_msgs/PointCloud2",throttle_rate:this.throttle_rate,queue_length:1,compression:this.compression}),this.rosTopic.subscribe(this.processMessage.bind(this))}processMessage(e){if(this.points.setup(e.header.frame_id,e.point_step,e.fields)){var t,i=this.points.pointRatio,s=this.max_pts*e.point_step;e.data.buffer?(this.buffer=e.data.slice(0,Math.min(e.data.byteLength,s)),t=Math.min(e.height*e.width/i,this.points.positions.array.length/3)):((!this.buffer||this.buffer.byteLength<s)&&(this.buffer=new Uint8Array(s)),t=Q(e.data,this.buffer,e.point_step,i),i=1);for(var r,o,n=new DataView(this.buffer.buffer),a=!e.is_bigendian,c=this.points.fields.x.offset,h=this.points.fields.y.offset,l=this.points.fields.z.offset,u=0;u<t;u++)r=u*i*e.point_step,this.points.positions.array[3*u]=n.getFloat32(r+c,a),this.points.positions.array[3*u+1]=n.getFloat32(r+h,a),this.points.positions.array[3*u+2]=n.getFloat32(r+l,a),this.points.colors&&(o=this.points.colormap(this.points.getColor(n,r,a)),this.points.colors.array[3*u]=o.r,this.points.colors.array[3*u+1]=o.g,this.points.colors.array[3*u+2]=o.b);this.points.update(t)}}}class Z extends h.Object3D{constructor(e){super(),e=e||{},this.frame_id=e.frame_id,this.tfClient=e.tfClient,this.rootObject=e.rootObject||new h.Object3D,this.axes=new S({shaftRadius:e.shaftRadius||.025,headRadius:e.headRaidus||.07,headLength:e.headLength||.2,scale:e.scale||1,lineType:e.lineType||"full",lineDashLength:e.lineDashLength||.1}),this.sn=new P({frameID:this.frame_id,tfClient:this.tfClient,object:this.axes}),this.rootObject.add(this.sn)}}class J extends h.Object3D{constructor(e){var t=(e=e||{}).urdfModel,i=e.path||"/",s=e.tfClient,r=e.tfPrefix||"",o=e.loader;super();var n=t.links;for(var a in n)for(var h=n[a],u=0;u<h.visuals.length;u++){var p=h.visuals[u];if(p&&p.geometry){var d=r+"/"+h.name,f=null;if(p.material&&p.material.color){var m=p.material&&p.material.color;f=l(m.r,m.g,m.b,m.a)}if(p.geometry.type===c.URDF_MESH){var v=p.geometry.filename,g=v.indexOf("package://");-1!==g&&(v=v.substr(g+"package://".length));var b=v.substr(-3).toLowerCase();if(w.loaders[b]){var y=new x({path:i,resource:v,loader:o,material:f});h.visuals[u].geometry.scale&&y.scale.copy(p.geometry.scale);var _=new P({frameID:d,pose:p.origin,tfClient:s,object:y});_.name=p.name,this.add(_)}else console.warn("Could not load geometry mesh: "+v)}else{var M=this.createShapeMesh(p,e),T=new P({frameID:d,pose:p.origin,tfClient:s,object:M});T.name=p.name,this.add(T)}}}}createShapeMesh(e,t){var i,s=null;switch(s||(s=l(0,0,0,1)),e.geometry.type){case c.URDF_BOX:var r=e.geometry.dimension,o=new h.BoxGeometry(r.x,r.y,r.z);i=new h.Mesh(o,s);break;case c.URDF_CYLINDER:var n=e.geometry.radius,a=e.geometry.length,u=new h.CylinderGeometry(n,n,a,16,1,!1);(i=new h.Mesh(u,s)).quaternion.setFromAxisAngle(new h.Vector3(1,0,0),.5*Math.PI);break;case c.URDF_SPHERE:var p=new h.SphereGeometry(e.geometry.radius,16);i=new h.Mesh(p,s)}return i}unsubscribeTf(){this.children.forEach((function(e){"function"==typeof e.unsubscribeTf&&e.unsubscribeTf()}))}}class ${constructor(e){e=e||{},this.mouseHandler=e.mouseHandler,this.hoverObjs={},this.mouseHandler.addEventListener("mouseover",this.onMouseOver.bind(this)),this.mouseHandler.addEventListener("mouseout",this.onMouseOut.bind(this))}onMouseOver(e){this.hoverObjs[e.currentTarget.uuid]=e.currentTarget}onMouseOut(e){var t=e.currentTarget.uuid;t in this.hoverObjs&&delete this.hoverObjs[t]}renderHighlights(e,t,i){this.makeEverythingInvisible(e),this.makeHighlightedVisible(e);var s=e.overrideMaterial;e.overrideMaterial=new h.MeshBasicMaterial({fog:!1,opacity:.5,transparent:!0,depthTest:!0,depthWrite:!1,polygonOffset:!0,polygonOffsetUnits:-1,side:h.DoubleSide}),t.render(e,i),e.overrideMaterial=s,this.restoreVisibility(e)}makeEverythingInvisible(e){e.traverse((function(e){(e instanceof h.Mesh||e instanceof h.Line||e instanceof h.Sprite)&&(e.previousVisibility=e.visible,e.visible=!1)}))}makeHighlightedVisible(e){var t=function(e){(e instanceof h.Mesh||e instanceof h.Line||e instanceof h.Sprite)&&(e.visible=!0)};for(var i in this.hoverObjs){var s=this.hoverObjs[i];s.visible=!0,s.traverse(t)}}restoreVisibility(e){e.traverse(function(e){e.hasOwnProperty("previousVisibility")&&(e.visible=e.previousVisibility)}.bind(this))}}class ee extends h.EventDispatcher{constructor(e){super(),this.renderer=e.renderer,this.camera=e.camera,this.rootObject=e.rootObject,this.fallbackTarget=e.fallbackTarget,this.lastTarget=this.fallbackTarget,this.dragging=!1;this.listeners={},["contextmenu","click","dblclick","mouseout","mousedown","mouseup","mousemove","mousewheel","DOMMouseScroll","touchstart","touchend","touchcancel","touchleave","touchmove"].forEach((function(e){this.listeners[e]=this.processDomEvent.bind(this),this.renderer.domElement.addEventListener(e,this.listeners[e],!1)}),this)}processDomEvent(e){e.preventDefault();var t,i,s=e.target,r=s.getBoundingClientRect();if(-1!==e.type.indexOf("touch")){t=0,i=0;for(var o=0;o<e.touches.length;++o)t+=e.touches[o].clientX,i+=e.touches[o].clientY;t/=e.touches.length,i/=e.touches.length}else t=e.clientX,i=e.clientY;var n=t-r.left-s.clientLeft+s.scrollLeft,a=i-r.top-s.clientTop+s.scrollTop,c=n/s.clientWidth*2-1,l=-a/s.clientHeight*2+1,u=new h.Vector2(c,l),p=new h.Raycaster;p.params.Line.threshold=.001,p.setFromCamera(u,this.camera);var d={mousePos:u,mouseRay:p.ray,domEvent:e,camera:this.camera,intersection:this.lastIntersection};if("mouseout"===e.type)return this.dragging&&(this.notify(this.lastTarget,"mouseup",d),this.dragging=!1),this.notify(this.lastTarget,"mouseout",d),void(this.lastTarget=null);if("touchleave"===e.type||"touchend"===e.type)return this.dragging&&(this.notify(this.lastTarget,"mouseup",d),this.dragging=!1),this.notify(this.lastTarget,"touchend",d),void(this.lastTarget=null);if(this.dragging)return this.notify(this.lastTarget,e.type,d),void(("mouseup"===e.type&&2===e.button||"click"===e.type||"touchend"===e.type)&&(this.dragging=!1));s=this.lastTarget;var f;if((f=p.intersectObject(this.rootObject,!0)).length>0?(s=f[0].object,d.intersection=this.lastIntersection=f[0]):s=this.fallbackTarget,s!==this.lastTarget&&e.type.match(/mouse/)){var m=this.notify(s,"mouseover",d);0===m?this.notify(this.lastTarget,"mouseout",d):1===m&&(s=this.fallbackTarget)!==this.lastTarget&&(this.notify(s,"mouseover",d),this.notify(this.lastTarget,"mouseout",d))}s!==this.lastTarget&&e.type.match(/touch/)&&(this.notify(s,e.type,d)?(this.notify(this.lastTarget,"touchleave",d),this.notify(this.lastTarget,"touchend",d)):(s=this.fallbackTarget)!==this.lastTarget&&(this.notify(this.lastTarget,"touchmove",d),this.notify(this.lastTarget,"touchend",d)));this.notify(s,e.type,d),"mousedown"!==e.type&&"touchstart"!==e.type&&"touchmove"!==e.type||(this.dragging=!0),this.lastTarget=s}notify(e,t,i){for(i.type=t,i.cancelBubble=!1,i.continueBubble=!1,i.stopPropagation=function(){i.cancelBubble=!0},i.continuePropagation=function(){i.continueBubble=!0},i.currentTarget=e;i.currentTarget;){if(i.currentTarget.dispatchEvent&&i.currentTarget.dispatchEvent instanceof Function){if(i.currentTarget.dispatchEvent(i),i.cancelBubble)return this.dispatchEvent(i),0;if(i.continueBubble)return 2}i.currentTarget=i.currentTarget.parent}return 1}}class te extends h.EventDispatcher{constructor(e){super();var t=this,i=(e=e||{}).scene;this.camera=e.camera,this.center=new h.Vector3,this.userZoom=!0,this.userZoomSpeed=e.userZoomSpeed||1,this.userRotate=!0,this.userRotateSpeed=e.userRotateSpeed||1,this.autoRotate=e.autoRotate,this.autoRotateSpeed=e.autoRotateSpeed||2,this.displayPanAndZoomFrame=void 0===e.displayPanAndZoomFrame||!!e.displayPanAndZoomFrame,this.lineTypePanAndZoomFrame=e.dashedPanAndZoomFrame||"full",this.camera.up=new h.Vector3(0,0,1);var s=1800,r=new h.Vector2,o=new h.Vector2,n=new h.Vector2,a=new h.Vector2,c=new h.Vector2,l=new h.Vector2,u=new h.Vector3,p=new h.Vector3,d=new h.Vector3,f=new h.Vector3,m=new Array(2),v=new Array(2);this.phiDelta=0,this.thetaDelta=0,this.scale=1,this.lastPosition=new h.Vector3;var g=-1,b=0,y=1,w=2,x=g;function _(e,t,i){var s=new h.Vector3;new h.Vector3;s.subVectors(t,e.origin);var r=e.direction.dot(i);if(Math.abs(r)<e.precision)return null;var o=i.dot(s)/r;return e.direction.clone().multiplyScalar(o)}function M(e){if(t.userZoom){var i=e.domEvent;(void 0!==i.wheelDelta?i.wheelDelta:-i.detail)>0?t.zoomIn():t.zoomOut(),this.showAxes()}}this.axes=new S({shaftRadius:.025,headRadius:.07,headLength:.2,lineType:this.lineTypePanAndZoomFrame}),this.displayPanAndZoomFrame&&(i.add(this.axes),this.axes.traverse((function(e){e.visible=!1}))),this.addEventListener("mousedown",(function(e){var i=e.domEvent;switch(i.preventDefault(),i.button){case 0:x=b,r.set(i.clientX,i.clientY);break;case 1:x=w,p=new h.Vector3(0,0,1);var s=(new h.Matrix4).extractRotation(this.camera.matrix);p.applyMatrix4(s),u=t.center.clone(),d=t.camera.position.clone(),f=_(e.mouseRay,u,p);break;case 2:x=y,a.set(i.clientX,i.clientY)}this.showAxes()})),this.addEventListener("mouseup",(function(e){t.userRotate&&(x=g)})),this.addEventListener("mousemove",(function(e){var i=e.domEvent;if(x===b)o.set(i.clientX,i.clientY),n.subVectors(o,r),t.rotateLeft(2*Math.PI*n.x/s*t.userRotateSpeed),t.rotateUp(2*Math.PI*n.y/s*t.userRotateSpeed),r.copy(o),this.showAxes();else if(x===y)c.set(i.clientX,i.clientY),l.subVectors(c,a),l.y>0?t.zoomIn():t.zoomOut(),a.copy(c),this.showAxes();else if(x===w){var m=_(e.mouseRay,t.center,p);if(!m)return;var v=(new h.Vector3).subVectors(f.clone(),m.clone());t.center.addVectors(u.clone(),v.clone()),t.camera.position.addVectors(d.clone(),v.clone()),t.update(),t.camera.updateMatrixWorld(),this.showAxes()}})),this.addEventListener("touchstart",(function(e){var i=e.domEvent;switch(i.touches.length){case 1:x=b,r.set(i.touches[0].pageX-window.scrollX,i.touches[0].pageY-window.scrollY);break;case 2:x=g,p=new h.Vector3(0,0,1);var s=(new h.Matrix4).extractRotation(this.camera.matrix);p.applyMatrix4(s),u=t.center.clone(),d=t.camera.position.clone(),f=_(e.mouseRay,u,p),m[0]=new h.Vector2(i.touches[0].pageX,i.touches[0].pageY),m[1]=new h.Vector2(i.touches[1].pageX,i.touches[1].pageY),v[0]=new h.Vector2(0,0),v[1]=new h.Vector2(0,0)}this.showAxes(),i.preventDefault()})),this.addEventListener("touchmove",(function(e){var i=e.domEvent;if(x===b)o.set(i.touches[0].pageX-window.scrollX,i.touches[0].pageY-window.scrollY),n.subVectors(o,r),t.rotateLeft(2*Math.PI*n.x/s*t.userRotateSpeed),t.rotateUp(2*Math.PI*n.y/s*t.userRotateSpeed),r.copy(o),this.showAxes();else{if(v[0].set(m[0].x-i.touches[0].pageX,m[0].y-i.touches[0].pageY),v[1].set(m[1].x-i.touches[1].pageX,m[1].y-i.touches[1].pageY),v[0].lengthSq()>10&&v[1].lengthSq()>10&&(m[0].set(i.touches[0].pageX,i.touches[0].pageY),m[1].set(i.touches[1].pageX,i.touches[1].pageY),v[0].dot(v[1])>0&&x!==y?x=w:v[0].dot(v[1])<0&&x!==w&&(x=y),x===y)){var a=new h.Vector2;a.subVectors(m[0],m[1]),v[0].dot(a)<0&&v[1].dot(a)>0?t.zoomOut():v[0].dot(a)>0&&v[1].dot(a)<0&&t.zoomIn()}if(x===w){var c=_(e.mouseRay,t.center,p);if(!c)return;var l=(new h.Vector3).subVectors(f.clone(),c.clone());t.center.addVectors(u.clone(),l.clone()),t.camera.position.addVectors(d.clone(),l.clone()),t.update(),t.camera.updateMatrixWorld()}this.showAxes(),i.preventDefault()}})),this.addEventListener("touchend",(function(e){var t=e.domEvent;1===t.touches.length&&x!==b?(x=b,r.set(t.touches[0].pageX-window.scrollX,t.touches[0].pageY-window.scrollY)):x=g})),this.addEventListener("mousewheel",M),this.addEventListener("DOMMouseScroll",M)}showAxes(){var e=this;this.axes.traverse((function(e){e.visible=!0})),this.hideTimeout&&clearTimeout(this.hideTimeout),this.hideTimeout=setTimeout((function(){e.axes.traverse((function(e){e.visible=!1})),e.hideTimeout=!1}),1e3)}rotateLeft(e){void 0===e&&(e=2*Math.PI/60/60*this.autoRotateSpeed),this.thetaDelta-=e}rotateRight(e){void 0===e&&(e=2*Math.PI/60/60*this.autoRotateSpeed),this.thetaDelta+=e}rotateUp(e){void 0===e&&(e=2*Math.PI/60/60*this.autoRotateSpeed),this.phiDelta-=e}rotateDown(e){void 0===e&&(e=2*Math.PI/60/60*this.autoRotateSpeed),this.phiDelta+=e}zoomIn(e){void 0===e&&(e=Math.pow(.95,this.userZoomSpeed)),this.scale/=e}zoomOut(e){void 0===e&&(e=Math.pow(.95,this.userZoomSpeed)),this.scale*=e}update(){var e=this.camera.position,t=e.clone().sub(this.center),i=Math.atan2(t.y,t.x),s=Math.atan2(Math.sqrt(t.y*t.y+t.x*t.x),t.z);this.autoRotate&&this.rotateLeft(2*Math.PI/60/60*this.autoRotateSpeed),i+=this.thetaDelta,s+=this.phiDelta;var r=1e-6;s=Math.max(r,Math.min(Math.PI-r,s));var o=t.length();t.set(o*Math.sin(s)*Math.cos(i),o*Math.sin(s)*Math.sin(i),o*Math.cos(s)),t.multiplyScalar(this.scale),e.copy(this.center).add(t),this.camera.lookAt(this.center),o=t.length(),this.axes.position.copy(this.center),this.axes.scale.set(.05*o,.05*o,.05*o),this.axes.updateMatrixWorld(!0),this.thetaDelta=0,this.phiDelta=0,this.scale=1,this.lastPosition.distanceTo(this.camera.position)>0&&(this.dispatchEvent({type:"change"}),this.lastPosition.copy(this.camera.position))}}return e.Arrow=m,e.Arrow2=R,e.Axes=S,e.DepthCloud=f,e.Grid=D,e.Highlighter=$,e.INTERACTIVE_MARKER_BUTTON=2,e.INTERACTIVE_MARKER_BUTTON_CLICK=3,e.INTERACTIVE_MARKER_FIXED=1,e.INTERACTIVE_MARKER_INHERIT=0,e.INTERACTIVE_MARKER_KEEP_ALIVE=0,e.INTERACTIVE_MARKER_MENU=1,e.INTERACTIVE_MARKER_MENU_SELECT=2,e.INTERACTIVE_MARKER_MOUSE_DOWN=4,e.INTERACTIVE_MARKER_MOUSE_UP=5,e.INTERACTIVE_MARKER_MOVE_3D=7,e.INTERACTIVE_MARKER_MOVE_AXIS=3,e.INTERACTIVE_MARKER_MOVE_PLANE=4,e.INTERACTIVE_MARKER_MOVE_ROTATE=6,e.INTERACTIVE_MARKER_MOVE_ROTATE_3D=9,e.INTERACTIVE_MARKER_NONE=0,e.INTERACTIVE_MARKER_POSE_UPDATE=1,e.INTERACTIVE_MARKER_ROTATE_3D=8,e.INTERACTIVE_MARKER_ROTATE_AXIS=5,e.INTERACTIVE_MARKER_VIEW_FACING=2,e.InteractiveMarker=C,e.InteractiveMarkerClient=class{constructor(e){e=e||{},this.ros=e.ros,this.tfClient=e.tfClient,this.topicName=e.topic,this.path=e.path||"/",this.camera=e.camera,this.rootObject=e.rootObject||new h.Object3D,this.loader=e.loader,this.menuFontSize=e.menuFontSize||"0.8em",this.interactiveMarkers={},this.updateTopic=null,this.feedbackTopic=null,this.topicName&&this.subscribe(this.topicName)}subscribe(e){this.unsubscribe(),this.updateTopic=new c.Topic({ros:this.ros,name:e+"/tunneled/update",messageType:"visualization_msgs/InteractiveMarkerUpdate",compression:"cbor"}),this.updateTopic.subscribe(this.processUpdate.bind(this)),this.feedbackTopic=new c.Topic({ros:this.ros,name:e+"/feedback",messageType:"visualization_msgs/InteractiveMarkerFeedback",compression:"cbor"}),this.feedbackTopic.advertise(),this.initService=new c.Service({ros:this.ros,name:e+"/tunneled/get_init",serviceType:"demo_interactive_markers/GetInit"});var t=new c.ServiceRequest({});this.initService.callService(t,this.processInit.bind(this))}unsubscribe(){for(var e in this.updateTopic&&this.updateTopic.unsubscribe(),this.feedbackTopic&&this.feedbackTopic.unadvertise(),this.interactiveMarkers)this.eraseIntMarker(e);this.interactiveMarkers={}}processInit(e){var t=e.msg;for(var i in t.erases=[],this.interactiveMarkers)t.erases.push(i);t.poses=[],this.processUpdate(t)}processUpdate(e){var t=this;e.erases.forEach((function(e){t.eraseIntMarker(e)})),e.poses.forEach((function(e){var i=t.interactiveMarkers[e.name];i&&i.setPoseFromServer(e.pose)})),e.markers.forEach((function(e){var i=t.interactiveMarkers[e.name];i&&t.eraseIntMarker(i.name);var s=new O({message:e,feedbackTopic:t.feedbackTopic,tfClient:t.tfClient,menuFontSize:t.menuFontSize});t.interactiveMarkers[e.name]=s;var r=new C({handle:s,camera:t.camera,path:t.path,loader:t.loader});r.name=e.name,t.rootObject.add(r),s.on("pose",(function(e){r.onServerSetPose({pose:e})})),r.addEventListener("user-pose-change",s.setPoseFromClientBound),r.addEventListener("user-mousedown",s.onMouseDownBound),r.addEventListener("user-mouseup",s.onMouseUpBound),r.addEventListener("user-button-click",s.onButtonClickBound),r.addEventListener("menu-select",s.onMenuSelectBound),s.subscribeTf()}))}eraseIntMarker(e){if(this.interactiveMarkers[e]){var t=this.rootObject.getObjectByName(e);this.rootObject.remove(t);var i=this.interactiveMarkers[e];i.unsubscribeTf(),t.removeEventListener("user-pose-change",i.setPoseFromClientBound),t.removeEventListener("user-mousedown",i.onMouseDownBound),t.removeEventListener("user-mouseup",i.onMouseUpBound),t.removeEventListener("user-button-click",i.onButtonClickBound),t.removeEventListener("menu-select",i.onMenuSelectBound),delete this.interactiveMarkers[e],t.dispose()}}},e.InteractiveMarkerControl=E,e.InteractiveMarkerHandle=O,e.InteractiveMarkerMenu=A,e.LaserScan=H,e.MARKER_ARROW=0,e.MARKER_CUBE=1,e.MARKER_CUBE_LIST=6,e.MARKER_CYLINDER=3,e.MARKER_LINE_LIST=5,e.MARKER_LINE_STRIP=4,e.MARKER_MESH_RESOURCE=10,e.MARKER_POINTS=8,e.MARKER_SPHERE=2,e.MARKER_SPHERE_LIST=7,e.MARKER_TEXT_VIEW_FACING=9,e.MARKER_TRIANGLE_LIST=11,e.Marker=k,e.MarkerArrayClient=class extends j{constructor(e){super(),e=e||{},this.ros=e.ros,this.topicName=e.topic,this.tfClient=e.tfClient,this.rootObject=e.rootObject||new h.Object3D,this.path=e.path,this.markers={},this.rosTopic=void 0,this.subscribe()}subscribe(){this.unsubscribe(),this.rosTopic=new c.Topic({ros:this.ros,name:this.topicName,messageType:"visualization_msgs/MarkerArray",compression:"cbor"}),this.rosTopic.subscribe(this.processMessage.bind(this))}processMessage(e){e.markers.forEach(function(e){if(0===e.action){var t=!1;if(e.ns+e.id in this.markers&&((t=this.markers[e.ns+e.id].children[0].update(e))||this.removeMarker(e.ns+e.id)),!t){var i=new k({message:e,path:this.path});this.markers[e.ns+e.id]=new P({frameID:e.header.frame_id,tfClient:this.tfClient,object:i}),this.rootObject.add(this.markers[e.ns+e.id])}}else if(1===e.action)console.warn('Received marker message with deprecated action identifier "1"');else if(2===e.action)this.removeMarker(e.ns+e.id);else if(3===e.action){for(var s in this.markers)this.removeMarker(s);this.markers={}}else console.warn('Received marker message with unknown action identifier "'+e.action+'"')}.bind(this)),this.emit("change")}unsubscribe(){this.rosTopic&&this.rosTopic.unsubscribe()}removeMarker(e){var t=this.markers[e];t&&(t.unsubscribeTf(),this.rootObject.remove(t),t.children.forEach((e=>{e.dispose()})),delete this.markers[e])}},e.MarkerClient=class extends j{constructor(e){super(),e=e||{},this.ros=e.ros,this.topicName=e.topic,this.tfClient=e.tfClient,this.rootObject=e.rootObject||new h.Object3D,this.path=e.path||"",this.lifetime=e.lifetime||0,this.markers={},this.rosTopic=void 0,this.updatedTime={},this.subscribe()}unsubscribe(){this.rosTopic&&this.rosTopic.unsubscribe()}checkTime(e){if((new Date).getTime()-this.updatedTime[e]>this.lifetime)this.removeMarker(e),this.emit("change");else{var t=this;setTimeout((function(){t.checkTime(e)}),100)}}subscribe(){this.unsubscribe(),this.rosTopic=new c.Topic({ros:this.ros,name:this.topicName,messageType:"visualization_msgs/Marker",compression:"cbor"}),this.rosTopic.subscribe(this.processMessage.bind(this))}processMessage(e){var t=this.markers[e.ns+e.id];if(this.updatedTime[e.ns+e.id]=(new Date).getTime(),t?this.removeMarker(e.ns+e.id):this.lifetime&&this.checkTime(e.ns+e.id),0===e.action){var i=new k({message:e,path:this.path});this.markers[e.ns+e.id]=new P({frameID:e.header.frame_id,tfClient:this.tfClient,object:i}),this.rootObject.add(this.markers[e.ns+e.id])}this.emit("change")}removeMarker(e){var t=this.markers[e];t&&(t.unsubscribeTf(),this.rootObject.remove(t),t.children.forEach((e=>{e.dispose()})),delete this.markers[e])}},e.MeshLoader=w,e.MeshResource=x,e.MouseHandler=ee,e.NavSatFix=K,e.OccupancyGrid=V,e.OccupancyGridClient=class extends j{constructor(e){super(),e=e||{},this.ros=e.ros,this.topicName=e.topic||"/map",this.compression=e.compression||"cbor",this.continuous=e.continuous,this.tfClient=e.tfClient,this.rootObject=e.rootObject||new h.Object3D,this.offsetPose=e.offsetPose||new c.Pose,this.color=e.color||{r:255,g:255,b:255},this.opacity=e.opacity||1,this.currentGrid=null,this.rosTopic=void 0,this.subscribe()}unsubscribe(){this.rosTopic&&this.rosTopic.unsubscribe()}subscribe(){this.unsubscribe(),this.rosTopic=new c.Topic({ros:this.ros,name:this.topicName,messageType:"nav_msgs/OccupancyGrid",queue_length:1,compression:this.compression}),this.sceneNode=null,this.rosTopic.subscribe(this.processMessage.bind(this))}processMessage(e){this.currentGrid&&(this.currentGrid.tfClient&&this.currentGrid.unsubscribeTf(),this.sceneNode.remove(this.currentGrid),this.currentGrid.dispose());var t=new V({message:e,color:this.color,opacity:this.opacity});this.tfClient?(this.currentGrid=t,null===this.sceneNode?(this.sceneNode=new P({frameID:e.header.frame_id,tfClient:this.tfClient,object:t,pose:this.offsetPose}),this.rootObject.add(this.sceneNode)):this.sceneNode.add(this.currentGrid)):(this.sceneNode=this.currentGrid=t,this.rootObject.add(this.currentGrid)),this.emit("change"),this.continuous||this.rosTopic.unsubscribe()}},e.Odometry=F,e.OrbitControls=te,e.Path=I,e.Point=z,e.PointCloud2=Y,e.Points=q,e.Polygon=U,e.Pose=B,e.PoseArray=G,e.PoseWithCovariance=W,e.SceneNode=P,e.TFAxes=Z,e.TriangleList=_,e.Urdf=J,e.UrdfClient=class{constructor(e){var t=this,i=(e=e||{}).ros;this.param=e.param||"robot_description",this.path=e.path||"/",this.tfClient=e.tfClient,this.rootObject=e.rootObject||new h.Object3D,this.tfPrefix=e.tfPrefix||"",this.loader=e.loader,new c.Param({ros:i,name:this.param}).get((function(e){var i=new c.UrdfModel({string:e});t.urdf=new J({urdfModel:i,path:t.path,tfClient:t.tfClient,tfPrefix:t.tfPrefix,loader:t.loader}),t.rootObject.add(t.urdf)}))}},e.Viewer=class{constructor(e){var t=(e=e||{}).divID,i=e.elem,s=e.width,r=e.height,o=e.background||"#111111",n=e.antialias,a=e.intensity||.66,c=e.near||.01,l=e.far||1e3,u=e.alpha||1,p=e.cameraPose||{x:3,y:3,z:3},d=e.cameraZoomSpeed||.5,f=void 0===e.displayPanAndZoomFrame||!!e.displayPanAndZoomFrame,m=e.lineTypePanAndZoomFrame||"full";this.renderer=new h.WebGLRenderer({antialias:n,alpha:!0}),this.renderer.setClearColor(parseInt(o.replace("#","0x"),16),u),this.renderer.sortObjects=!1,this.renderer.setSize(s,r),this.renderer.shadowMap.enabled=!1,this.renderer.autoClear=!1,this.scene=new h.Scene,this.camera=new h.PerspectiveCamera(40,s/r,c,l),this.camera.position.x=p.x,this.camera.position.y=p.y,this.camera.position.z=p.z,this.cameraControls=new te({scene:this.scene,camera:this.camera,displayPanAndZoomFrame:f,lineTypePanAndZoomFrame:m}),this.cameraControls.userZoomSpeed=d,this.scene.add(new h.AmbientLight(5592405)),this.directionalLight=new h.DirectionalLight(16777215,a),this.scene.add(this.directionalLight),this.selectableObjects=new h.Group,this.scene.add(this.selectableObjects);var v=new ee({renderer:this.renderer,camera:this.camera,rootObject:this.selectableObjects,fallbackTarget:this.cameraControls});this.highlighter=new $({mouseHandler:v}),this.stopped=!0,this.animationRequestId=void 0,(i||document.getElementById(t)).appendChild(this.renderer.domElement),this.start()}start(){this.stopped=!1,this.draw()}draw(){this.stopped||(this.cameraControls.update(),this.directionalLight.position.normalize(),this.renderer.clear(!0,!0,!0),this.renderer.render(this.scene,this.camera),this.highlighter.renderHighlights(this.scene,this.renderer,this.camera),this.animationRequestId=requestAnimationFrame(this.draw.bind(this)))}stop(){this.stopped||cancelAnimationFrame(this.animationRequestId),this.stopped=!0}addObject(e,t){t?this.selectableObjects.add(e):this.scene.add(e)}resize(e,t){this.camera.aspect=e/t,this.camera.updateProjectionMatrix(),this.renderer.setSize(e,t)}},e.closestAxisPoint=d,e.findClosestPoint=p,e.intersectPlane=u,e.makeColorMaterial=l,Object.defineProperty(e,"__esModule",{value:!0}),e}({},THREE$1,ROSLIB,BufferGeometryUtils_js);
